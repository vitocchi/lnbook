<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="generator" content="Asciidoctor 2.0.16" />
<title>ライトニングノードソフトウェア</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700" />
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="set_up_a_lightning_node">ライトニングノードソフトウェア</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これまでの章で見てきたように、ライトニングノードとは、ライトニングネットワークに参加するコンピュータシステムのことです。ライトニングネットワークは製品や企業ではなく、相互運用性のベースラインを定義するオープンスタンダードの集合体である。そのため、ライトニングノードのソフトウェアは、様々な企業やコミュニティグループによって構築されています。Lightningソフトウェアの大部分は<em>オープンソース</em>です。つまり、開発プロセスにおけるコラボレーション、共有、コミュニティの参加を可能にするような方法でソースコードが公開され、ライセンスが付与されているのです。同様に、本章で紹介するLightningノードの実装もすべてオープンソースであり、共同開発されたものです。</p>
</div>
<div class="paragraph">
<p>ビットコインがソフトウェアでの<em>参照実装</em>（Bitcoin Core）によって標準を定義しているのとは異なり、ライトニングでは、<a href="https://github.com/lightningnetwork/lightning-rfc"><em>lightning-rfc</em>リポジトリに</a>ある<em>BOLT（</em> <em>Basis of Lightning Technology</em>）と呼ばれる一連の標準文書によって標準が定義されている。</p>
</div>
<div class="paragraph">
<p>ライトニング・ネットワークのリファレンス実装はありませんが、異なるチームや組織によって開発された、BOLTに準拠し、相互運用可能な複数の競合実装が存在します。ライトニング・ネットワークのソフトウェアを開発するチームは、BOLT標準の開発・進化にも貢献しています。</p>
</div>
<div class="paragraph">
<p>ライトニングノードソフトウェアとビットコインノードソフトウェアのもう一つの大きな違いは、ライトニングノードはコンセンサスルールに沿って動作する必要がなく、BOLTのベースラインを超える拡張機能を持つことができる点である。そのため、さまざまなチームがさまざまな実験的機能を追求し、それが成功して広く展開されれば、後にBOLTの一部となる可能性があります。</p>
</div>
<div class="paragraph pagebreak-before">
<p>この章では、最も一般的な Lightning ノードの実装のためのソフトウェア パッケージをそれぞれセットアップする方法を学びます。アルファベット順に表示したのは、一般的にどれが優れているとか、どれを推奨しているというわけではないことを強調するためです。それぞれ長所と短所があり、どちらを選ぶかは様々な要因によります。これらは異なるプログラミング言語（Go、Cなど）で開発されているため、特定の言語や開発ツールセットに対する親しみや専門知識のレベルによっても選択が変わってくるかもしれません。</p>
</div>
<div class="sect2">
<h3 id="_lightning_development_environment">ライトニング開発環境</h3>
<div class="paragraph">
<p>開発者であれば、Lightning ソフトウェアを作成し実行するためのすべてのツール、ライブラリ、サポート ソフトウェアを備えた開発環境をセットアップしたいと思うでしょう。この高度に技術的な章では、そのプロセスを順を追って説明します。内容が濃すぎる場合や、実際に開発環境を構築していない場合は、技術的な要素が少ない次の章に進んでください。</p>
</div>
<div class="sect3">
<h4 id="_using_the_command_line">コマンドラインを使用する</h4>
<div class="paragraph">
<p>この章、そしてより広くこの本のほとんどの例では、コマンドライン・ターミナルを使用しています。つまり、ターミナルにコマンドを入力し、テキスト応答を受け取るということです。さらに、この例は、LinuxカーネルとGNUソフトウェアシステムに基づくオペレーティングシステム、特にUbuntuの最新の長期安定リリース（Ubuntu 20.04 LTS）で実証されています。WindowsやmacOSなど他のOSでも、コマンドを少し修正すれば、ほとんどの例を再現することができます。オペレーティングシステム間の最大の違いは、さまざまなソフトウェアライブラリとその前提条件をインストールする<em>パッケージマネージャ</em>です。与えられた例では、Ubuntuのパッケージマネージャであるaptを使用することにします。macOSでは、オープンソースの開発によく使われるパッケージマネージャは<a href="https://brew.sh">Homebrewで</a>、brewというコマンドでアクセスします。</p>
</div>
<div class="paragraph">
<p>ここで紹介するほとんどの例では、ソースコードから直接ソフトウェアを構築しています。これは非常に難しいことですが、私たちに最も大きな力と制御を与えてくれます。もし行き詰まったら、Dockerコンテナ、プリコンパイルパッケージ、または他のインストールメカニズムを代わりに使用することもできます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">チップ</div>
</td>
<td class="content">
<div class="paragraph">
<p>本章の多くの例では、<em>ターミナル・</em>アプリケーションを介してアクセスするオペ レーティング・システムのコマンドライン・インターフェイス（<em>シェルとも</em>呼ばれる） を使用することになります。シェルは、まずプロンプトを表示し、コマンドの準備ができたことを示します。次に、コマンドを入力して Enter キーを押すと、シェルはいくつかのテキストで応答し、次のコマンドのための新しいプロンプトが表示されます。プロンプトはあなたのシステムによって異なるかもしれませんが、以下の例では $ 記号で示されます。例では、$ 記号の後にテキストが表示された場合、$ 記号を入力せず、その直後にコマンドを入力します。そして、Enterキーを押して、コマンドを実行します。例では、各コマンドに続く行は、そのコマンドに対するオペレーティング・システムの応答です。次の$の接頭辞が見えたら、それが新しいコマンドであることがわかりますので、この作業を繰り返してください。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>一貫性を保つために、すべてのコマンドラインの例でbashシェルを使用しています。他のシェルでも同様の動作をするので、シェルなしですべての例を実行できますが、一部のシェルスクリプトはbashシェル専用に書かれており、他のシェルで実行するには多少の変更またはカスタマイズが必要な場合があります。一貫性を保つために、bash シェルは Windows と macOS にインストールでき、ほとんどの Linux システムにはデフォルトでインストールされています。</p>
</div>
</div>
<div class="sect3">
<h4 id="_downloading_the_book_repository">書庫のダウンロード</h4>
<div class="paragraph">
<p>すべてのコード例は、本書のオンラインリポジトリで公開されています。リポジトリは可能な限り最新の状態に保たれるため、印刷された本や電子書籍からコピーするのではなく、常にオンラインリポジトリから最新版を探すようにしましょう。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/lnbook/lnbook">GitHubに</a>アクセスし、右側の緑色のCodeボタンを選択すると、リポジトリをZIPバンドルでダウンロードできます。</p>
</div>
<div class="paragraph">
<p>あるいは、git コマンドを使用して、バージョン管理されたリポジトリのクローンをローカルコンピューターに作成することもできます。Git は分散型バージョン管理システムで、ほとんどの開発者がソフトウェア開発の共同作業やソフトウェアリポジトリの変更点の追跡のために使用しています。Git<a href="https://git-scm.com">プロジェクトからの</a>指示に従って、git をダウンロードし、インストールしてください。</p>
</div>
<div class="paragraph">
<p>自分のコンピュータにリポジトリのローカルコピーを作成するには、次のようにgitコマンドを実行します。</p>
</div>
<div id="git-clone-lnbook" class="listingblock">
<div class="content">
<pre>$ git clone https://github.com/lnbook/lnbook.git</pre>
</div>
</div>
<div class="paragraph">
<p>これで、lnbookというフォルダーにブックリポジトリの完全なコピーができました。新しくダウンロードしたディレクトリに変更するために、以下を実行します。</p>
</div>
<div id="cd-lnbook" class="listingblock">
<div class="content">
<pre>$ cd lnbook</pre>
</div>
</div>
<div class="paragraph">
<p>これ以降の例では、このフォルダー内からコマンドを実行することを想定しています。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docker_containers">Dockerコンテナ</h3>
<div class="paragraph">
<p>多くの開発者は、仮想マシンの一種である<em>コンテナを</em>使用して、必要な依存関係をすべて備えた事前設定済みのオペレーティングシステムとアプリケーションをインストールします。Lightningソフトウェアの多くは、<a href="https://docker.com">Dockerの</a>ホームページにある<em>Dockerの</em>ようなコンテナシステムを使用してインストールすることも可能です。コンテナによるインストールは、特にコマンドライン環境に慣れていない方にとって、非常に簡単です。</p>
</div>
<div class="paragraph">
<p>本書のリポジトリにはDockerコンテナのコレクションが含まれており、これを使用して一貫した開発環境を構築し、あらゆるシステムでサンプルを実践・複製することができます。コンテナは一貫した構成で動作する完全なオペレーティングシステムであるため、依存関係やライブラリのバージョン、構成の違いを気にすることなく、あなたのコンピュータでサンプルが動作することを確認できます。</p>
</div>
<div class="paragraph">
<p>Dockerコンテナは、小型化、すなわち最小限のディスクスペースを占有するように最適化されていることが多い。しかし、本書では、環境を<em>標準化</em>し、すべての読者に一貫性を持たせるために、コンテナを使用しています。さらに、これらのコンテナは、バックグラウンドでサービスを実行するために使用されることを意図していません。むしろ、サンプルをテストし、ソフトウェアと対話しながら学習するために使用することを意図しています。このような理由から、コンテナは非常に大きく、多くの開発ツールやユーティリティが付属しています。一般的に、Linuxコンテナには、サイズが小さいという理由でAlpineディストリビューションが使用されます。しかし、Ubuntuで構築されたコンテナを提供するのは、より多くの開発者がUbuntuに慣れており、サイズよりもこの親しみやすさが重要であるためです。</p>
</div>
<div class="paragraph">
<p>Dockerのインストールと使用方法、およびそのコマンドについては、<a href="#appendix_docker">[appendix_docker]</a>で詳しく説明されています。もしあなたがDockerに慣れていないのであれば、今すぐそのセクションを確認する良い機会です。</p>
</div>
<div class="paragraph">
<p>最新のコンテナ定義とビルド構成は、この本のリポジトリの<em>code/docker</em>フォルダにあります。各コンテナは、以下のように別々のフォルダーに入っています。</p>
</div>
<div id="tree" class="listingblock">
<div class="content">
<pre>$ tree -F --charset=asciii code/docker</pre>
</div>
</div>
<div id="docker-dir-list" class="listingblock">
<div class="content">
<pre>コード/ドッカー
|-- bitcoind/
|-- bashrc
| |-- bitcoind/
| |-- bitcoin.conf
| |-- keys/
| |-- demo_address.txt
| |-- demo_mnemonic.txt（デモ・ニーモニック・タブレット
| |-- demo_privkey.txt
| |-- bitcoind-entrypoint.sh
|-- cli
|-- Dockerfile
|-- mine.sh*
|-- c-lightning/
|-- bashrc
|-- cli
|-- c-lightning-entrypoint.sh
|-- devkeys.pem
|-- Dockerfile
|-- fund-c-lightning.sh
|-- lightningd/
|-- config
|-- logtail.sh
|-- wait-for-bitcoind.sh
|-- eclair/
|-- bashrc
|-- cli
|-- Dockerfile
|-- eclair/
| |-- eclair.conf
|-- eclair-entrypoint.sh
|-- logtail.sh
|-- wait-for-bitcoind.sh
|-- lnd/
|-- bashrc
|-- cli
|-- Dockerfile
|-- fund-lnd.sh
|-- lnd/
| |-- lnd.conf
|-- lnd-entrypoint.sh
|-- logtail.sh
|-- wait-for-bitcoind.sh
|-- check-versions.sh
|-- docker-compose.yml
|-- Makefile
`-- run-payment-demo.sh* ・・・・・・・・。</pre>
</div>
</div>
<div class="paragraph">
<p>次のいくつかのセクションで説明するように、これらのコンテナはローカルで構築することもできますし、<a href="https://hub.docker.com/orgs/lnbook"><em>Docker Hub</em></a>上のこの本のリポジトリから引っ張ってくることもできます。以下のセクションでは、あなたがDockerをインストール済みで、dockerコマンドの基本的な使い方に精通していることを前提に説明します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_bitcoin_core_and_regtest">Bitcoin CoreとREGTEST</h3>
<div class="paragraph">
<p>ライトニングノードの実装のほとんどは、動作させるために完全なビットコインノードへのアクセスが必要です。</p>
</div>
<div class="paragraph">
<p>完全なBitcoinノードのインストールとBitcoinブロックチェーンの同期は、本書の範囲外であり、それ自体比較的複雑な作業です。試してみたい方は、『<a href="https://github.com/bitcoinbook/bitcoinbook"><em>Mastering Bitcoin</em></a>』の「第3章 Bitcoin Core:Bitcoinノードのインストールと操作について説明している「The Reference Implementation」を参照してください。</p>
</div>
<div class="paragraph">
<p>Bitcoin ノードは、テスト目的でローカルにシミュレートされた Bitcoin ブロックチェーンを作成する、<code>regtest</code>モードで操作することができます。以下の例では、Bitcoinノードを同期させたり、資金をリスクにさらすことなくLightningを実証できるよう、regtestモードを使用することにします。</p>
</div>
<div class="paragraph">
<p>Bitcoin Coreのコンテナはbitcoindです。Bitcoin Coreをregtestモードで実行し、10秒ごとに6つの新しいブロックを採掘するよう設定されています。そのリモートプロシージャコール（RPC）ポートはポート18443で公開されており、ユーザー名regtestとパスワードregtestでRPCコールにアクセスできます。また、対話型シェルでアクセスし、ローカルでbitcoin-cliコマンドを実行することもできます。</p>
</div>
<div class="sect3">
<h4 id="_building_the_bitcoin_core_container">Bitcoin Coreコンテナの構築</h4>
<div class="paragraph">
<p>bitcoindのコンテナを用意しましょう。一番簡単な方法は、<em>Docker Hubから</em>最新のコンテナを引っ張ってくることです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/bitcoind
デフォルトのタグを使用: latest
最新のlnbook/bitcoind からのプル
35807b77a593 です。プル完了
e1b85b9c5571 です。プル完了
[...]
288f1cc78a00: 引継ぎが完了しました。
Digest: sha256:861e7e32c9ad650aa367af40fc5acff894e89e47aff4bd400691ae18f1b550e2
ステータスlnbook/bitcoind:latest のより新しいイメージをダウンロードしました。
ドッカー.io/lnbook/bitcoind:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、<em>code/docker/bitcoind/Dockerfile</em> にあるローカルコンテナ定義から、自分でコンテナを構築することもできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">備考</div>
</td>
<td class="content">
<div class="paragraph">
<p>以前にpullコマンドでDocker Hubからコンテナを取得した場合は、ビルドする必要はありません。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ローカルでコンテナを構築すると、ネットワークの帯域幅を少し減らすことができますが、構築のためにCPUの時間を多く使うことになります。ビルドには、docker buildコマンドを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker run -it --name bitcoind lnbook/bitcoind
bitcoindを起動中...
ビットコインコア起動中
bitcoindの起動を待ちます。
bitcoind 起動
================================================
デモの秘密鍵をインポート
ビットコインアドレスです。  2NBKgwSWY5qEmfN2Br4WtMDGuamjpuUc5q1
プライベートキー：cSaejkcWwU25jMweewRSsrVQq2FGTij1xjXv4x1XvxVRF1ZCr3
================================================
================================================
残高です。0.00000000
================================================
いくつかのビットコインをアンロックするために101ブロックを採掘する
[
  "34c744207fd4dd32b70bac467902bd8d030fba765c9f240a2e98f15f05338964",
  "64d82721c641c378d79b4ff2e17572c109750bea1d4eddbae0b54f51e4cdf23e",

 [...]

  "7a8c53dc9a3408c9ecf9605b253e5f8086d67bbc03ea05819b2c9584196c9294",
  "39e61e50e34a9bd1d6eab51940c39dc1ab56c30b21fc28e1a10c14a39b67a1c3",
  "4ca7fe9a55b0b767d2b7f5cf4d51a2346f035fe8c486719c60a46dcbe33de51a"
]
10秒ごとに6ブロック採掘
バランス50.00000000
[
  "5ce76cc475e40515b67e3c0237d1eef597047a914ba3f59bbd62fc3691849055",
  "1ecb27a05ecfa9dfa82a7b26631e0819b2768fe5e6e56c7a2e1078b078e21e9f",
  "717ceb8b6c329d57947c950dc5668fae65bddb7fa03203984da9d2069e20525b",
  "185fc7cf3557a6ebfc4a8cdd1f94a8fa08ed0c057040cdd68bfb7aee2d5be624",
  "59001ae237a3834ebe4f6e6047dcec8fd67df0352ddc70b6b02190f982a60384",
  "754c860fe1b9e0e7292e1de96a65eaa78047feb4c72dbbde2a1d224faa1499dd"
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>ご覧の通り、bitcoindは起動し、101個の模擬ブロックを採掘してチェーンをスタートさせています。これは、ビットコインのコンセンサスルールでは、新しく採掘されたビットコインは100ブロック経過しないと使えないからです。101ブロックを採掘することで、最初のブロックのコインベースを使えるようにするのです。この最初の採掘活動の後、10秒ごとに6つの新しいブロックが採掘され、チェーンが前進し続けるのです。</p>
</div>
<div class="paragraph">
<p>今のところ、取引はありません。しかし、ウォレットには採掘されたテスト用のビットコインがあり、使用することが可能です。このチェーンにいくつかのLightningノードを接続したら、彼らのウォレットにいくつかのビットコインを送り、Lightningノード間でいくつかのLightningチャンネルを開くことができるようにする予定です。</p>
</div>
<div class="sect4">
<h5 id="_interacting_with_the_bitcoin_core_container">ビットコインコアコンテナとの連動</h5>
<div class="paragraph">
<p>その間、bitcoindコンテナにシェルコマンドを送ることで対話することも可能です。コンテナはターミナルにログファイルを送信しており、bitcoindプロセスの採掘プロセスが表示されています。シェルと対話するには、別のターミナルでdocker execコマンドを使用してコマンドを発行することができます。以前、実行中のコンテナにname引数で名前を付けたので、docker execコマンドを実行する際にはその名前で参照できる。まず、対話型のbashシェルを実行してみよう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker exec -it bitcoind /bin/bash
root@e027fd56e31a:/bitcoind# ps x
  pid tty stat time コマンド
    1 pts/0 Ss+ 0:00 /bin/bash /usr/local/bin/mine.sh
    7 ?        Ssl 0:03 bitcoind -datadir=/bitcoind -daemon
   97 pts/1 Ss 0:00 /bin/bash
  124 pts/0 S+ 0:00 sleep 10
  125 pts/1 R+ 0:00 ps x
root@e027fd56e31a:/bitcoind# の場合。</pre>
</div>
</div>
<div class="paragraph">
<p>対話型シェルを実行すると、コンテナの「中」に入ることができます。新しいシェルプロンプトのプレフィックスが root@ であることからわかるように、ユーザールートとしてログインします root@e027fd56e31a:/bitcoind#.ps x コマンドを実行して実行中のプロセスを確認すると、bitcoind とスクリプト mine.sh の両方がバックグラウンドで実行されていることがわかります。このシェルを終了するには、Ctrl-D を押すか、<strong>exit と</strong>入力すると、オペレーティングシステムのプロンプトに戻ります。</p>
</div>
<div class="paragraph">
<p>インタラクティブなシェルを実行する代わりに、コンテナ内で実行されるコマンドを1つ発行することもできます。便宜上、bitcoin-cliコマンドには「cli」というエイリアスがあり、正しい設定を渡しています。そこで、ビットコインコードにブロックチェーンについて問い合わせるために実行してみましょう。cli getblockchaininfoを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec bitcoind cli getblockchaininfo
{
  "chain":"regtest",
  "blocks":131,
  "ヘッダー":131,
  "bestblockhash"。"2cf57aac35365f52fa5c2e626491df634113b2f1e5197c478d57378e5a146110",

[...]

  "警告":""
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>bitcoindコンテナのcliコマンドを使うと、Bitcoin Coreノードに対してRPCコマンドを発行し、JavaScript Object Notation（JSON）でエンコードされた結果を取得することができます。</p>
</div>
<div class="paragraph">
<p>さらに、すべてのDockerコンテナには、jqというコマンドラインJSONエンコーダ/デコーダがプリインストールされています。jqは、コマンドラインやスクリプト内部からJSONフォーマットのデータを処理するのに役立ちます。jqは、任意のコマンドのJSON出力を、｜文字を使って送ることができます。この文字とこの操作のことを "パイプ" と呼びます。以下のように、先ほどのコマンドにパイプとjqを適用してみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec bitcoind bash -c "cli getblockchaininfo | jq .blocks"
197</code></pre>
</div>
</div>
<div class="paragraph">
<p>jq .blocksは、jq JSONデコーダーに、<span class="keep-together">getblockchaininfoの</span>結果からフィールドブロックを抽出するように指示します。この例では、後続のコマンドで使用できる197という値を抽出して出力します。</p>
</div>
<div class="paragraph">
<p>以下のセクションで説明するように、複数のコンテナを同時に実行し、それらを個別に操作することができます。Lightningノードの公開鍵などの情報を抽出したり、別のノードに対してLightningチャネルを開くなどのアクションを実行するためのコマンドを発行することが可能です。docker runとdocker execコマンド、そしてJSONデコードのためのjqがあれば、さまざまなノードの実装が混在するLightning Networkを構築するのに必要なものはすべて揃う。これによって、自分のコンピュータで多様な実験を試すことができます。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_c_lightning_lightning_node_project">c-lightningライトニングノードプロジェクト</h3>
<div class="paragraph">
<p><code>c-lightningは</code>、Elements Projectの一環としてBlockstream社が開発した、軽量かつ高度にカスタマイズ可能な、標準に準拠したLNプロトコルの実装です。このプロジェクトはオープンソースであり、<a href="https://github.com/ElementsProject/lightning">GitHub</a>上で共同開発されています。</p>
</div>
<div class="paragraph">
<p>以下では、前回構築したbitcoindコンテナに接続して<code>c-lightning</code>ノードを動作させるDockerコンテナを構築します。また、ソースコードから直接<code>c-lightning</code>ソフトウェアを設定・ビルドする方法を紹介します。</p>
</div>
<div class="sect3">
<h4 id="_building_c_lightning_as_a_docker_container">Dockerコンテナとしてのc-lightningの構築</h4>
<div class="paragraph">
<p><code>c-lightningの</code>ソフトウェア配布にはDockerコンテナがありますが、これは本番システムでbitcoindノードと並行して<code>c-lightningを</code>実行するために設計されたものです。ここでは、デモ用に<code>c-lightningを</code>実行するように構成された、ややシンプルなコンテナを使用します。</p>
</div>
<div class="paragraph">
<p>本のDocker Hubリポジトリから<code>c-lightning</code>コンテナを引っ張ってきましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/c-lightning
デフォルトのタグを使用: latest
最新のlnbook/c-lightning からプルする。

[...]

Digest: sha256:bdefcefe8a9712e7b3a236dcc5ab12d999c46fd280e209712e7cb649b8bf0688
ステータスlnbook/c-lightning:latest 用のイメージをダウンロードしました。
ドッカー.io/lnbook/c-lightning:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>または、以前ダウンロードした書籍のファイルから、<code>c-lightningの</code>Dockerコンテナをlnbookというディレクトリにビルドします。前回と同様に、code/docker サブディレクトリで docker build コマンドを使用します。このように、コンテナイメージにlnbook/c-lightningというタグを付けます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker build -t lnbook/c-lightning c-lightning
ビルドコンテキストをDockerデーモンに送る 91.14kB
ステップ1/34 : ARG OS=ubuntu
ステップ2/34 : ARG OS_VER=focal
Step 3/34 : FROM ${OS}:${OS_VER} as os-base
 ---&gt; fb52e22af1b0

 [...]

ステップ34/34 : CMD ["/usr/local/bin/logtail.sh"] ---&gt; 8d3d6cdで実行中。
 ---&gt; 8d3d6c8799c5で実行中
中間コンテナ 8d3d6c8799c5 の削除
 ---&gt; 30b6fd5d7503
ビルドに成功しました 30b6fd5d7503
lnbook/c-lightning:latest のタグ付けに成功しました。</code></pre>
</div>
</div>
<div class="paragraph">
<p>これでコンテナはビルドされ、実行できるようになりました。しかし、<code>c-lightning</code>コンテナを実行する前に、別のターミナルでbitcoindコンテナを起動する必要があります。なぜなら、<code>c-lightningは</code>bitcoindに依存しているからです。また、コンテナ同士が同じローカルエリアネットワーク上にあるかのように接続できるように、Dockerネットワークを設定する必要があります。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">チップ</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dockerコンテナは、Dockerシステムによって管理される仮想ローカルエリアネットワーク上で互いに「会話」することができます。各コンテナはカスタム名を持つことができ、他のコンテナはその名前を使用してIPアドレスを解決し、簡単に接続することができます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_a_docker_network">Dockerネットワークの構築</h4>
<div class="paragraph">
<p>一度Dockerネットワークを設定すると、Dockerは再起動後など、Dockerの起動時に毎回ローカルコンピュータ上でネットワークを有効にする。そのため、docker network createコマンドで一度だけネットワークをセットアップする必要がある。ネットワーク名自体は重要ではありませんが、私たちのコンピュータ上でユニークである必要があります。デフォルトでは、Dockerはhost、bridge、noneという3つのネットワークを持っています。ここでは、新しいネットワークをlnbookと名付け、このように作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker network create lnbook
ad75c0e4f87e5917823187febedfc0d7978235ae3e88eca63abe7e0b5ee81bfb
$ docker ネットワーク ls
ネットワーク ID 名前 ドライバ スコープ
7f1fb63877ea ブリッジ ブリッジ ローカル
4e575cba0036 host host local
ad75c0e4f87e lnbook bridge local
ee8824567c95 none null local</code></pre>
</div>
</div>
<div class="paragraph">
<p>このように、docker network lsを実行すると、Dockerネットワークのリストが表示されます。私たちのlnbookネットワークが作成されています。ネットワークIDは自動的に管理されているので、無視しても大丈夫です。</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_bitcoind_and_c_lightning_containers">bitcoindとc-lightningコンテナの実行</h4>
<div class="paragraph">
<p>次に、bitcoindと<code>c-lightningの</code>コンテナを起動し、lnbookのネットワークに接続する。コンテナを特定のネットワークで実行するには、docker runに<span class="keep-together">network</span>引数を渡す必要がある。また、コンテナ同士が見つけやすいように、name引数でそれぞれのコンテナに名前を付けておく。このようにbitcoindを起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name bitcoind lnbook/bitcoind</code></pre>
</div>
</div>
<div class="paragraph">
<p>bitcoindが起動し、10秒ごとにブロックの採掘を開始するのが確認できるはずです。起動したままにしておき、新しいターミナルウィンドウを開いて<code>c-lightningを</code>起動します。同様のdocker runコマンドにnetworkとnameを引数として与えて、以下のように<code>c-lightning</code>を起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name c-lightning lnbook/c-lightning
bitcoindの起動を待っています...
bitcoindがブロックを採掘するのを待っています...
c-lightningの開始...
2021-09-12T13:14:50.434Z UNUSUAL lightningd:設定ディレクトリ /lightningd/regtest の作成
起動完了
c-lightningウォレットの資金調達
8a37a183274c52d5a962852ba9f970229ea6246a096ff1e4602b57f7d4202b31
lightningd:ログファイル /lightningd/lightningd.log のオープン
lightningd:設定ディレクトリ /lightningd/regtest の作成
lightningd:ログファイル /lightningd/lightningd.log を開きました。</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>c-lightning</code>コンテナが起動し、Dockerネットワーク経由でbitcoindコンテナに接続します。まず、<code>c-lightning</code>ノードは bitcoind が起動するのを待ち、bitcoind がウォレットにビットコインを採掘するまで待ちます。最後に、コンテナ起動の一部として、スクリプトがbitcoindノードにRPCコマンドを送信し、<code>c-lightningの</code>ウォレットに10テストBTCを入金するトランザクションが作成されます。これで、<code>c-lightning</code>ノードは実行されるだけでなく、テスト用のビットコインも手に入れることができました。</p>
</div>
<div class="paragraph">
<p>bitcoindコンテナで実証したように、別の端末で<code>c-lightning</code>コンテナにコマンドを発行して、情報を取り出したり、チャネルを開いたりすることができます。<code>c-lightning</code>ノードに対してコマンドライン命令を発行できるコマンドは、lightning-cliと呼ばれるものです。この lightning-cli コマンドは、このコンテナ内では cli というエイリアスでもあります。<code>c-lightning</code>ノードの情報を取得するには、別のターミナルウィンドウで以下のdocker execコマンドを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec c-lightning cli getinfo
{
   "id":"026ec53cc8940df5fed5fa18f8897719428a15d860ff4cd171fca9530879c7499e",
   "エイリアス":"IRATEARTIST "です。
   "color":"026ec5"。
   "num_peers":0,
   "num_pending_channels"。0,

[...]

   "バージョン":"0.10.1",
   "blockheight":221,
   "ネットワーク":"regtest"。
   "msatoshi_fees_collected":0,
   "fees_collected_msat"。"0msat "です。
   "lightning-dir":"/lightningd/regtest" です。
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、最初の Lightning ノードが仮想ネットワーク上で動作し、テスト用の Bitcoin ブロックチェーンと通信できるようになりました。この章の後半では、さらに多くのノードを起動し、それらを互いに接続してライトニング決済を行う予定です。</p>
</div>
<div class="paragraph">
<p>次のセクションでは、ソースコードから直接<code>c-lightningを</code>ダウンロードし、設定し、コンパイルする方法についても見ていきます。これは、ビルドツールの使い方を学び、<span class="keep-together"><code>c-lightningの</code></span>ソースコードに変更を加えることができるようになる、オプションで上級者向けのステップです。この知識があれば、コードを書いたり、バグを修正したり、<code>c-lightningの</code>プラグインを作ったりすることができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">備考</div>
</td>
<td class="content">
<div class="paragraph">
<p>Lightning ノードのソースコードやプログラミングに潜る予定がない場合は、次のセクションは完全にスキップしてかまいません。本書のほとんどの例では、先ほど構築したDockerコンテナで十分です。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_installing_c_lightning_from_source_code">ソースコードからのc-lightningのインストール</h4>
<div class="paragraph">
<p><code>c-lightningの</code>開発者は、ソースコードから<code>c-lightningを</code>構築するための詳細な手順を提供しています。ここでは、<a href="https://github.com/ElementsProject/lightning/blob/master/doc/INSTALL.md">GitHubからの</a>指示に従います。</p>
</div>
</div>
<div class="sect3">
<h4 id="_installing_prerequisite_libraries_and_packages">前提条件となるライブラリやパッケージのインストール</h4>
<div class="paragraph">
<p>このインストール手順は、Linux または GNU ビルドツールを使用した同様のシステムで<code>c-lightning</code>をビルドすることを想定しています。そうでない場合は、Elements Projectのリポジトリで、お使いのオペレーティングシステムに対応した説明書を探してください。</p>
</div>
<div class="paragraph">
<p>一般的な最初のステップは、前提条件となるライブラリのインストールです。これらをインストールするために、aptパッケージマネージャを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo apt-get update

ヒット数:1 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB］
Hit:2 http://eu-north-1b.clouds.archive.ubuntu.com/ubuntu bionic InRelease
Get:3 http://eu-north-1b.clouds.archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB] です。

[...]

18.3 MB を 8 秒でフェッチ (2,180 kB/s)
パッケージリストの読み込み完了

$ sudo apt-get install -y \...
  autoconf automake build-essential git libtool libgmp-dev \.
  libsqlite3-dev python python3 python3-mako net-tools zlib1g-dev \.
  libsodium-dev gettext

パッケージリストの読み込み...Done
依存関係ツリーの構築
状態情報の読み込み...完了
以下のパッケージが追加でインストールされます。
  autotools-dev binutils binutils-common binutils-x86-64-linux-gnu cpp cpp-7 dpkg-dev fakeroot g++ g++-7 gcc gcc-7-base libalgorithm-diff-perl

 [...]

libsigsegv2:amd64 (2.12-2) のセットアップ ...
libltdl-dev:amd64 (2.4.6-14)のセットアップ ...
python2 のセットアップ (2.7.17-2ubuntu4) ...
libsodium-dev:amd64 (1.0.18-1)のセットアップ ...

[...]
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>数分後、画面上で多くの操作が行われた後、必要なパッケージとライブラリがすべてインストールされます。これらのライブラリの多くは、他のLightningパッケージでも使用されており、一般的なソフトウェア開発に必要なものです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_copying_the_c_lightning_source_code">c-lightningのソースコードをコピーする</h4>
<div class="paragraph">
<p>次に、ソースコードレポジトリから最新版の<code>c-lightningを</code>コピーします。これはバージョン管理されたコピーをローカルマシンにクローンすることで、リポジトリ全体を再度ダウンロードすることなく、その後の変更と同期した状態を維持することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ git clone --recurse https://github.com/ElementsProject/lightning.git
lightning'にクローンする...
リモートでオブジェクトの列挙: 24, 完了。
リモートオブジェクトを数えています。100% (24/24)、完了。
リモートオブジェクトを圧縮しています。100% (22/22)、完了。
リモート合計53192（デルタ5）、再利用5（デルタ2）、パック再利用53168
オブジェクトを受信。100% (53192/53192), 29.59 MiB | 19.30 MiB/s,完了。
デルタを解決。100%(39834/39834)、完了。

$ cd lightning</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、<em>lightning</em>サブフォルダに<code>c-lightningの</code>コピーがクローンされ、cd（ディレクトリの変更）コマンドでそのサブフォルダに入ることができました。</p>
</div>
</div>
<div class="sect3">
<h4 id="_compiling_the_c_lightning_source_code">c-lightningのソースコードのコンパイル</h4>
<div class="paragraph">
<p>次に、多くのオープンソースプロジェクトで一般的に利用されている<em>ビルドスクリプト</em>一式を使用します。これらのビルドスクリプトは、configureコマンドとmakeコマンドを使用し、<span class="keep-together">以下の</span>ことを可能にします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ビルドオプションを選択し、必要な依存関係を確認する（configure）。</p>
</li>
<li>
<p>実行ファイルとライブラリのビルドとインストール(make)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>helpオプションを付けてconfigureを実行すると、利用可能なすべてのオプションが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./configure --help
使い方を説明します。./configure [--reconfigure] [setting=value] [options]を指定します。

オプションは以下の通りです。
  -prefix=(デフォルト/usr/local)
    make install のプレフィックス
  --enable/disable-developer (デフォルトはdisable)
    デベロッパーモード、テストに最適
  --enable/disable-experimental-features (デフォルトdisable)
    実験的な機能を有効にする
  --enable/disable-compat (default enable) コンパチブルモード。
    互換モード、ソフトウェアが壊れるかどうか確認するために無効にするのが良い
  --enable/disable-valgrind (デフォルト (autodetect))
    Valgrindでテストを実行する
  --enable/disable-static (デフォルトdisable)
    sqlite3、gmp、zlibのライブラリをスタティックリンクする
  --enable/disable-address-sanitizer (デフォルトdisable)
    address-sanitizerでコンパイルします。</pre>
</div>
</div>
<div class="paragraph">
<p>この例では、デフォルトを変更する必要はありません。したがって、デフォルトを使用するために、何もオプションを付けずにもう一度<span class="keep-together">configureを</span>実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./configure

ccan/tools/configurator/configurator のコンパイル...完了。
python3-makoをチェックする...見つかった
autoconfのユーザーを快適にする...あり
off_tが32bitであることをチェックする...no
alignof__のサポートチェック...あり

[...]

COMPATの設定...1
PYTESTが見つかりません
STATICの設定...0
設定ASAN... 0
TEST_NETWORKの設定... regtest
$</pre>
</div>
</div>
<div class="paragraph">
<p>次に、<code>c-lightning</code>プロジェクトのライブラリ、コンポーネント、実行ファイルをmakeコマンドでビルドします。この作業には数分かかり、コンピュータのCPUとディスクを酷使します。ファンからの騒音も予想されます。makeを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make

cc -DBINTOPKGLIBEXECDIR="\"../libexec/c-lightning"" -Wall -Wundef -Wmis...。

[...]

cc -Og ccan-asort.o ccan-autodata.o ccan-bitmap.o ccan-bitops.o ccan-...</code></pre>
</div>
</div>
<div class="paragraph">
<p>すべてがうまくいけば、前のコマンドの実行を停止するERRORメッセージは表示されないでしょう。<code>c-lightning</code>ソフトウェアパッケージがソースからコンパイルされ、前のステップで作成した実行可能なコンポーネントをインストールする準備が整いました。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sudo make install

mkdir -p /usr/local/bin
mkdir -p /usr/local/libexec/c-lightning
mkdir -p /usr/local/libexec/c-lightning/pluginsをコピーします。
mkdir -p /usr/local/share/man/man1
mkdir -p /usr/local/share/man/man5
mkdir -p /usr/local/share/man/man7
mkdir -p /usr/local/share/man/man8
mkdir -p /usr/local/share/doc/c-lightning
インストール cli/lightning-cli lightningd/lightningd /usr/local/bin
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>lightningd と lightning-cli コマンドが正しくインストールされたことを確認するために、各実行ファイルにバージョン情報を問い合わせます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ lightningd --バージョン
v0.10.1-34-gfe86c11
$ lightning-cli --バージョン
v0.10.1-34-gfe86c11</code></pre>
</div>
</div>
<div class="paragraph">
<p>バージョンは、最新のリリースバージョン（v0.10.1）、リリースからの変更点数（34）、そして最後にどのリビジョンかを正確に示すハッシュ（fe86c11）で構成されています。この本が出版された後も、ソフトウェアは進化を続けているので、前回表示されたバージョンとは異なるバージョンが表示されるかもしれません。しかし、どのバージョンであっても、コマンドが実行され、バージョン情報が表示されるということは、<code>c-lightningの</code>ビルドに成功したことを意味します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_lightning_network_daemon_node_project">ライトニング・ネットワーク・デーモン・ノード・プロジェクト</h3>
<div class="paragraph">
<p>Lightning Network Daemon (LND) は、Lightning Labs による LN ノードの完全な実装です。LND プロジェクトは、lnd (デーモン本体) や lncli (コマンドラインユーティリティ) など、多くの実行可能なアプリケーションを提供しています。LNDには、btcd（フルノード）、bitcoind（ビットコイン・コア）、Neutrino（新しい実験的なライトクライアント）など、プラグイン可能なバックエンドチェーンサービスがいくつかあります。LNDはプログラミング言語Goで書かれています。このプロジェクトはオープンソースで、<a href="https://github.com/LightningNetwork/lnd">GitHub</a>上で共同開発されています。</p>
</div>
<div class="paragraph">
<p>次のセクションでは、LNDを実行するためのDockerコンテナを構築し、ソースコードからLNDを構築し、LNDの設定と実行方法について学びます。</p>
</div>
<div class="sect3">
<h4 id="_the_lnd_docker_container">LNDのDockerコンテナ</h4>
<div class="paragraph">
<p>本のDocker Hub<span class="keep-together">リポジトリから</span>、LNDのサンプルDockerコンテナを引っ張ってくることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/lnd
デフォルトのタグを使用: latest
最新版lnbook/lnd からプルする
35807b77a593 です。すでに存在します
e1b85b9c5571:すでに存在する
52f9c252546e:プル完了

[...]

Digest: sha256:e490a0de5d41b781c0a7f9f548c99e67f9d728f72e50cd4632722b3ed3d85952
ステータスlnbook/lnd:latest 用の新しいイメージをダウンロードしました。
ドッカー.io/lnbook/lnd:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>あるいは、LNDコンテナをローカルにビルドすることもできます。このコンテナは、<em>code/docker/lndに</em>あります。作業ディレクトリを<em>code/dockerに</em>変更し、docker buildコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker build -t lnbook/lnd lnd
ビルドコンテキストをDockerデーモンに送信する 9.728kB
ステップ 1/29 :FROM golang:1.13 as lnd-base
 ---&gt; e9bdcb0f0af9
ステップ 2/29 :ENV GOPATH /go

[...]

ステップ29/29 :CMD ["/usr/local/bin/logtail.sh"] を実行します。
 ---&gt; キャッシュの使用
 ---&gt; 397ce833ce14
397ce833ce14のビルドに成功しました。
lnbook/lnd:latestのタグ付けに成功しました。</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、私たちのコンテナは実行できるようになりました。前回構築した<code>c-lightning</code>コンテナと同様に、LND コンテナも Bitcoin Core のインスタンスが動作していることが前提になります。前回と同様に、別の端末でbitcoindコンテナを起動し、LNDをDockerネットワークで接続する必要があります。すでに lnbook という Docker ネットワークを構築しているので、ここでもそれを利用します。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">チップ</div>
</td>
<td class="content">
<div class="paragraph">
<p>通常、各ノード運営者は、自分のサーバーで自分のLightningノードと自分のBitcoinノードを動かしています。私たちの場合、1つのbitcoindコンテナが多くのLightningノードにサービスを提供することができます。私たちのシミュレーションネットワークでは、複数のライトニングノードを稼働させ、すべて1つのビットコインノードに接続し、レグテストモードで稼働させることができます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_bitcoind_and_lnd_containers">bitcoindとLNDコンテナの実行</h4>
<div class="paragraph">
<p>前回と同様に、あるターミナルでbitcoindコンテナを起動し、別のターミナルでLNDを起動します。すでに bitcoind コンテナを起動している場合は、再起動する必要はありません。起動したままにして、次のステップをスキップしてください。lnbookネットワークでbitcoindを起動するには、以下のようにdocker runを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name bitcoind lnbook/bitcoind</code></pre>
</div>
</div>
<div class="paragraph">
<p>次に、先ほど構築したLNDコンテナを起動します。先ほどと同様に、lnbookネットワークにアタッチし、名前を付ける必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --ネットワーク lnbook --名前 lnd lnbook/lnd
bitcoindの起動を待っています...
bitcoindがブロックを採掘するのを待っています...
lndを起動中...
起動完了
lndウォレットをファンディング中
{"result":"dbd1c8e2b224e0a511c11efb985dabd84d72d935957ac30935ec4211d28beacb","error":null,"id":"lnd-run-container"}
[INF] LTND: バージョン: 0.13.1-beta commit=v0.13.1-beta, build=production, logging=default, debuglevel=info。
[INF] LTND: アクティブなチェーンです。Bitcoin (ネットワーク=regtest)
[INF] RPCS:TLS証明書を生成しています...</code></pre>
</div>
</div>
<div class="paragraph">
<p>LND コンテナが起動し、Docker ネットワーク経由で bitcoind コンテナに接続します。まず、LND ノードは bitcoind が起動するのを待ち、bitcoind がウォレットにいくらかのビットコインを採掘するまで待ちます。最後に、コンテナ起動の一部として、スクリプトはbitcoindノードにRPCコマンドを送信し、それによってLNDウォレットに10テストBTCで資金を供給するトランザクションを作成します。</p>
</div>
<div class="paragraph">
<p>前回示したように、別の端末でコンテナに対してコマンドを発行することで、情報の抽出やチャネルのオープンなどを行うことができます。lndデーモンにコマンドライン命令を発行できるコマンドは、lncliと呼ばれます。今回もこのコンテナでは、適切なパラメータをすべて指定してlncliを実行するcliというエイリアスを用意している。別のターミナルウィンドウでdocker execコマンドを使用してノード情報を取得してみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec lnd cli getinfo
{
    "version":"0.13.1-beta commit=v0.13.1-beta",
    "commit_hash":"596fd90ef310cd7abbf2251edaae9ba4d5f8a689",
    "identity_pubkey":"02d4545dccbeda29a10f44e891858940f4f3374b75c0f85dcb7775bb922fdeaa14",

[...]

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、lnbook ネットワーク上でもう 1 つの Lightning ノードが動作し、bitcoind と通信しています。もしまだ<code>c-lightning</code>コンテナを実行しているのであれば、現在2つのノードが動いていることになります。まだお互いに接続されていませんが、近日中に接続する予定です。</p>
</div>
<div class="paragraph">
<p>必要であれば、同じ Lightning Network 上で LND と<code>c-lightning</code>ノードの任意の組み合わせを実行することができます。例えば、2つ目のLNDノードを実行する場合は、以下のように異なるコンテナ名でdocker runコマンドを発行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name lnd2 lnbook/lnd</code></pre>
</div>
</div>
<div class="paragraph">
<p>先のコマンドでは、別のLNDコンテナを起動し、lnd2という名前を付けています。名前は、ユニークである限り、完全にあなた次第です。もし名前を指定しなければ、Dockerは "naughty_einstein "のような2つの英単語をランダムに組み合わせてユニークな名前を作成します。これは、私たちがこの段落を書いたときに、Dockerが実際に選んだ名前です。なんて面白いんでしょう!</p>
</div>
<div class="paragraph">
<p>次のセクションでは、LND をソースコードから直接ダウンロードしてコンパイルする方法について見ていきます。これはオプションで、Go言語のビルドツールの使い方を学び、LNDのソースコードに修正を加えることができるようになる高度なステップです。この知識があれば、コードを書いたり、バグを修正したりすることができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">備考</div>
</td>
<td class="content">
<div class="paragraph">
<p>Lightning ノードのソースコードやプログラミングに潜る予定がない場合は、次のセクションは完全にスキップしてかまいません。本書のほとんどの例では、先ほど構築したDockerコンテナで十分です。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_installing_lnd_from_source_code">ソースコードからのLNDのインストール</h4>
<div class="paragraph">
<p>このセクションでは、LNDをゼロから構築します。LNDはプログラミング言語Goで書かれています。Goについてもっと知りたい場合は、無関係な結果を避けるために、goの代わりにgolangで検索してください。CやC++ではなくGoで書かれているため、以前に<code>c-lightningで</code>使用したGNU autotools/makeフレームワークとは異なる「ビルド」フレームワークを使用します。しかし、心配しないでください。golangのツールをインストールして使うのはとても簡単で、それぞれのステップをここで紹介します。Goは共同ソフトウェア開発に最適な言語です。なぜなら、作者の数に関係なく、非常に一貫性があり、正確で、読みやすいコードを作成できるからです。Goは、言語のバージョン間で一貫性を保つように、焦点を絞った「ミニマリスト」です。また、コンパイルされた言語であるため、非常に効率的です。さあ、始めましょう。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md">LNDプロジェクトのドキュメント</a>に記載されているインストール手順に従います。</p>
</div>
<div class="paragraph">
<p>まず、golangパッケージと関連するライブラリをインストールします。厳密にはGoバージョン1.13以降が必要です。公式のGo言語パッケージは<a href="https://golang.org/dl">Go</a>プロジェクトからバイナリとして配布されています。また、便宜上、aptコマンドで入手できるDebianパッケージとしても配布されています。<a href="https://golang.org/dl">Go</a>プロジェクトからの指示に従うか、<a href="https://github.com/golang/go/wiki/Ubuntu">GitHubのGo言語に関するwikiページ</a>で説明されているように、Debian/Ubuntu Linuxシステムで以下のaptコマンドを使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo apt install golang-go</code></pre>
</div>
</div>
<div class="paragraph">
<p>正しいバージョンがインストールされ、使用できる状態であることを、実行することで確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ go バージョン
go バージョン go1.13.4 linux/amd64</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.13.4を手に入れましたので、準備は完了です...Go!次に、Goのコードがどこにあるのか、プログラムに教える必要があります。これは環境変数GOPATHを設定することで実現できます。通常、Goのコードはユーザーのホームディレクトリに直接ある<em>gocodeという</em>ディレクトリにあります。次の2つのコマンドで、一貫してGOPATHを設定し、シェルが実行可能なPATHに追加することを確認します。ユーザーのホームディレクトリは、シェルでは ~ と呼ばれることに注意してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ export GOPATH=~/gocode
$ export PATH=$PATH:$GOPATH/binをエクスポートします。</code></pre>
</div>
</div>
<div class="paragraph">
<p>シェルを開くたびにこれらの環境変数を設定する必要がないように、この2行をホームディレクトリにあるbashシェル設定ファイル<em>.bashrcの</em>最後に、お好みのエディタで追加してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_copying_the_lnd_source_code">LNDのソースコードをコピーする</h4>
<div class="paragraph">
<p>最近の多くのオープンソースプロジェクトと同様に、LNDのソースコードはGitHub<em>(www.github.com)</em>にあります。go getコマンドはGitプロトコルを使って直接取得することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ go get -d github.com/lightningnetwork/lnd</code></pre>
</div>
</div>
<div class="paragraph">
<p>GOPATHの下に、LNDのソースコードを含むサブディレクトリができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_compiling_the_lnd_source_code">LNDソースコードのコンパイル</h4>
<div class="paragraph">
<p>LNDはmakeというビルドシステムを使用しています。プロジェクトをビルドするには、LNDのソースコードにディレクトリを変更し、次のようにmakeを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd $GOPATH/src/github.com/lightningnetwork/lnd
make &amp;&amp; make install</code></pre>
</div>
</div>
<div class="paragraph">
<p>数分後、2つの新しいコマンド、lndとlncliがインストールされていることでしょう。それらを試してみて、インストールされていることを確認するためにバージョンをチェックしてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ lnd --バージョン
lnd version 0.10.99-beta commit=clock/v1.0.0-106-gc1ef5bb908606343d2636c8cd345169e064bdc91
$ lncli --バージョン
lncli version 0.10.99-beta commit=clock/v1.0.0-106-gc1ef5bb908606343d2636c8cd345169e064bdc91</code></pre>
</div>
</div>
<div class="paragraph">
<p>この本が出版された後も、ソフトウェアは進化し続けているので、前回表示されたバージョンとは異なるバージョンが表示される可能性があります。しかし、どのバージョンであっても、コマンドが実行され、バージョン情報が表示されるということは、LNDソフトウェアのビルドに成功したことを意味します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_eclair_lightning_node_project">エクレア・ライトニング・ノード・プロジェクト</h3>
<div class="paragraph">
<p>Eclair（フランス語で稲妻の意味）はACINQ社製のLightning NetworkのScala実装です。Eclairは、最も人気があり先駆的なモバイルLightningウォレットの1つでもあり、<a href="#getting-started">[get-started]</a>でLightning決済のデモに使用されました。このセクションでは、Lightningノードを実行するEclairサーバープロジェクトについて検証します。Eclairはオープンソースプロジェクトであり、<a href="https://github.com/ACINQ/eclair">GitHubで</a>見つけることができます。</p>
</div>
<div class="paragraph">
<p>次のセクションでは、以前に<code>c-lightningと</code>LNDで行ったように、Eclairを実行するためのDockerコンテナを構築します。また、Eclair をソースコードから直接ビルドします。</p>
</div>
<div class="sect3">
<h4 id="_the_eclair_docker_container">エクレールDockerコンテナ</h4>
<div class="paragraph">
<p>Docker Hubのリポジトリから、この本のエクレールコンテナを引っ張ってきましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/eclair
デフォルトのタグを使用: latest
最新のlnbook/eclair からプルする。
35807b77a593 です。すでに存在します
e1b85b9c5571:すでに存在する

[...]

c7d5d5c616c2: プルアップが完了しました。
Digest: sha256:17a3d52bce11a62381727e919771a2d5a51da9f91ce2689c7ecfb03a6f028315
ステータスlnbook/eclair:latest のより新しいイメージをダウンロードしました。
ドッカー.io/lnbook/eclair:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>あるいは、代わりにコンテナをローカルにビルドすることもできます。ここまでで、あなたはほぼDockerの基本操作のエキスパートになっているはずですこのセクションでは、以前に見た多くのコマンドを繰り返して、Eclair コンテナを構築していきます。コンテナは<em>code/docker/eclair</em> に配置されています。ターミナルで作業ディレクトリを<em>code/docker</em>に切り替え、docker build コマンドを発行して開始します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker build -t lnbook/eclair eclair
ビルドコンテキストをDockerデーモンに送信する 11.26kB
ステップ1/27:ARG OS=ubuntu
ステップ2/27 :ARG OS_VER=focal
ステップ3/27 :FROM ${OS}:${OS_VER} as os-base
 ---&gt; fb52e22af1b0

[...]

ステップ27/27 :CMD ["/usr/local/bin/logtail.sh"] を実行します。
 ---&gt; fe639120b726で実行中。
中間コンテナfe639120b726の削除
 ---&gt; e6c8fe92a87c
e6c8fe92a87cのビルドに成功しました。
lnbook/eclair:latest のタグ付けに成功しました。</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで私たちのイメージは実行できるようになりました。Eclair コンテナも、Bitcoin Core の実行中のインスタンスに依存します。前回と同様に、別の端末で bitcoind コンテナを起動し、Docker ネットワーク経由で Eclair を接続する必要があります。lnbook という Docker ネットワークをすでにセットアップしていますので、ここではそれを再利用します。</p>
</div>
<div class="paragraph">
<p>Eclair と LND または<code>c-lightning</code>の顕著な違いは、Eclair には独立したビットコイン財布がなく、代わりに Bitcoin Core のビットコイン財布に直接依存していることです。LND を使用して、Bitcoin Core のウォレットから LND のビットコインウォレットにビットコインを転送するトランザクションを実行することによって、そのビットコインウォレットに資金を供給していたことを思い出してください。このステップは、Eclair を使用する場合は必要ありません。Eclairを実行する場合、Bitcoin Coreのウォレットはチャンネルを開くための資金源として直接使用されます。その結果、LND または<code>c-lightning</code>コンテナとは異なり、Eclair コンテナには、起動時にビットコインをウォレットに転送するスクリプトが含まれません。</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_bitcoind_and_eclair_containers">bitcoindとEclairコンテナの実行</h4>
<div class="paragraph">
<p>前回と同様に、あるターミナルでbitcoindコンテナを、別のターミナルでEclairコンテナを起動します。すでに bitcoind コンテナを起動している場合は、再起動する必要はありません。起動したままにして、次のステップをスキップしてください。lnbookネットワークでbitcoindを起動するには、以下のようにdocker runを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name bitcoind lnbook/bitcoind</code></pre>
</div>
</div>
<div class="paragraph">
<p>次に、先ほど構築した Eclair コンテナを起動します。他のコンテナで行ったのと同様に、このコンテナを lnbook ネットワークにアタッチして、名前を付ける必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name eclair lnbook/eclair
bitcoindの起動を待っています...
bitcoindがブロックを採掘するのを待っています...
eclairの起動...
eclairノードが開始されました。
INFO o.b.Secp256k1Context - secp256k1 ライブラリが正常にロードされました。
INFO fr.acinq.eclair.Plugin - 0個のプラグインをロードしています。
INFO a.e.slf4j.Slf4jLogger - Slf4jLogger が開始されました。
INFO fr.acinq.eclair.Setup - こんにちは!
INFO fr.acinq.eclair.Setup - バージョン 0.4.2 コミット=52444b0

[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eclairコンテナが起動し、Dockerネットワークを介してbitcoindコンテナに接続します。まず、私たちのEclairノードはbitcoindが起動するのを待ち、bitcoindがウォレットにいくらかのビットコインを採掘するまで待ちます。</p>
</div>
<div class="paragraph">
<p>前回示したように、別の端末でコンテナに対してコマンドを発行することで、情報の抽出やチャネルのオープンなどを行うことができます。eclair デーモンにコマンドライン命令を発行できるコマンドは eclair-cli と呼ばれます。前回と同様、このコンテナではeclair-cliの便利なエイリアスとして、必要な引数やパラメータを提供するcliというシンプルなものを用意しました。別のターミナルウィンドウで docker exec コマンドを使用して、Eclair からノード情報を取得します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec eclair cli getinfo
{
  "version":"0.4.2-52444b0",
  "nodeId":"02fa6d5042eb8098e4d9c9d99feb7ebc9e257401ca7de829b4ce757311e0301de7",
  "エイリアス":"エクレア",
  "色":"#49daa "です。
  "特徴":{

[...]

  },
  "chainHash":"06226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f",
  "ネットワーク":"regtest "です。
  "blockHeight":779,
  "publicAddresses "を指定します。[],
  "instanceId":"01eb7a68-5db0-461b-bdd0-29010df40d73"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、lnbookネットワーク上でもう1つのLightningノードが稼働し、bitcoindと通信していることが確認できました。同じ Lightning ネットワーク上で任意の数、任意の組み合わせの Lightning ノードを実行することができます。Eclair、LND、<code>c-lightning の</code>各ノードは、任意の数だけ共存することができます。例えば、2つ目のEclairノードを実行するには、以下のように異なるコンテナ名でdocker runコマンドを発行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name eclair2 lnbook/eclair</code></pre>
</div>
</div>
<div class="paragraph">
<p>先のコマンドでは、eclair2 という名前の別の Eclair コンテナを起動しています。</p>
</div>
<div class="paragraph">
<p>次のセクションでは、ソースコードから直接Eclairをダウンロードしてコンパイルする方法についても見ていきます。これは、Scala および Java 言語のビルドツールの使用方法を学び、Eclair のソースコードに修正を加えることができるようになる、オプションかつ上級者向けのステップです。この知識があれば、コードを書いたり、バグを修正したりすることができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">備考</div>
</td>
<td class="content">
<div class="paragraph">
<p>Lightning ノードのソースコードやプログラミングに潜る予定がない場合は、次のセクションは完全にスキップしてかまいません。本書のほとんどの例では、先ほど構築したDockerコンテナで十分です。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_installing_eclair_from_source_code">ソースコードからのEclairのインストール</h4>
<div class="paragraph">
<p>このセクションでは、ゼロからEclairを構築します。Eclair は Scala プログラミング言語で書かれており、Java コンパイラーを使用してコンパイルされています。Eclairを実行するには、まずJavaとそのビルドツールをインストールする必要があります。ここでは、Eclair プロジェクトの<a href="https://github.com/ACINQ/eclair/blob/master/BUILD.md"> <em>BUILD.md</em>ドキュメントに</a>記載されている指示に従います。</p>
</div>
<div class="paragraph">
<p>必要なJavaコンパイラは、OpenJDK 11の一部です。また、Mavenというビルドフレームワークが必要で、バージョンは3.6.0以上です。</p>
</div>
<div class="paragraph">
<p>Debian/UbuntuのLinuxシステムでは、以下のようにaptコマンドでOpenJDK 11とMavenの両方をインストールすることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo apt install openjdk-11-jdk maven</code></pre>
</div>
</div>
<div class="paragraph">
<p>を実行して、正しいバージョンがインストールされていることを確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ javac -version
javac 11.0.7
$ mvn -v
Apache Maven 3.6.1
Mavenのホームです。/usr/share/maven
Javaバージョン：11.0.7、ベンダ。Ubuntu、ランタイム。/usr/lib/jvm/java-11-openjdk-amd64</code></pre>
</div>
</div>
<div class="paragraph">
<p>OpenJDK 11.0.7とMaven 3.6.1があるので、準備はOKです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_copying_the_eclair_source_code">エクレアのソースコードをコピーする</h4>
<div class="paragraph">
<p>EclairのソースコードはGitHubにあります。git clone コマンドを使えば、ローカルにコピーを作成することができます。ホームディレクトリに移動して、そこで実行してみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd ~
$ git clone https://github.com/ACINQ/eclair.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>git cloneが終了すると、Eclairサーバーのソースコードを含むサブディレクトリeclairができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_compiling_the_eclair_source_code">Eclairソースコードのコンパイル</h4>
<div class="paragraph">
<p>EclairはMavenビルドシステムを使用しています。プロジェクトをビルドするために、作業ディレクトリをEclairのソースコードに変更し、次のようにmvnパッケージを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd eclair
$ mvn パッケージ
[INFO] プロジェクトをスキャンしています...
[INFO] ------------------------------------------------------------------------
[INFO] Reactor のビルド順です。
[INFO］
[INFO] --------------------&lt; fr.acinq.eclair:eclair_2.13 &gt;----------------------。
[INFO] eclair_2.13 0.4.3-SNAPSHOTのビルド [1/4].
INFO] --------------------------------[ pom ]-------------------------------- [1/4

[...]


[INFO] ------------------------------------------------------------------------
[情報] 成功の構築
[INFO] ------------------------------------------------------------------------
[INFO] 総時間：01:06分
[INFO] 終了した時間2020-12-12T09:43:21-04:00
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>数分後、Eclairパッケージのビルドが完了するはずです。しかし、"package "アクションはテストも実行し、そのうちのいくつかはインターネットに接続するため、失敗する可能性があります。テストをスキップしたい場合は、コマンドに -DskipTests を追加してください。</p>
</div>
<div class="paragraph">
<p>ここで、GitHubから<a href="https://github.com/ACINQ/eclair#installing-eclair">Eclairのインストール方法に従って</a>、ビルドパッケージを解凍して実行します。</p>
</div>
<div class="paragraph">
<p>おめでとうございます。あなたは Eclair をソースからビルドし、コーディング、テスト、バグ修正、そしてこのプロジェクトに貢献する準備ができています!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_building_a_complete_network_of_diverse_lightning_nodes">多様なライトニングノードの完全なネットワーク構築</h3>
<div class="paragraph">
<p>このセクションで紹介する最後の例では、これまで構築した様々なコンテナをまとめて、様々な（LND、<code>c-lightning</code>、Eclair）ノード実装からなる Lightning ネットワークを形成します。ノード同士を接続し、あるノードから別のノードへのチャネルを開くことで、ネットワークを構成します。最後に、これらのチャネルを経由して支払いを行います。</p>
</div>
<div class="paragraph">
<p>この例では、Alice、Bob、Chan、Dinaという4つのLightningノードからなるライトニングネットワークのデモを構築します。AliceとBob、BobとChan、ChanとDinaを接続することにします。これは、<a href="#alice_bob_chan_dina_network_demo">A small demonstration network of four nodes</a>に示されています。</p>
</div>
<div id="alice_bob_chan_dina_network_demo" class="imageblock">
<div class="content">
<img src="images/mtln_1002.png" alt="A small demonstration network of four nodes" />
</div>
<div class="title">図1.4つのノードからなる小規模なデモネットワーク</div>
</div>
<div class="paragraph">
<p>最後に、Dina に請求書を作成させ、Alice にその請求書を支払わせる。Alice と Dina は直接接続されていないので、支払いはすべての支払チャネルで HTLC としてルーティングされます。</p>
</div>
<div class="sect3">
<h4 id="_using_docker_compose_to_orchestrate_docker_containers">docker-composeを使用したDockerコンテナのオーケストレーション</h4>
<div class="paragraph">
<p>この例を実現するために、docker-composeというコマンドとして提供されている<em>コンテナオーケストレーションツールを</em>使用することにします。このコマンドを使うと、複数のコンテナで構成されたアプリケーションを指定し、連携しているコンテナをまとめて起動することでアプリケーションを実行することができます。</p>
</div>
<div class="paragraph">
<p>まず、docker-composeをインストールしましょう。<a href="https://docs.docker.com/compose/install">手順は</a>お使いのOSによって異なります。</p>
</div>
<div class="paragraph">
<p>インストールが完了したら、以下のように<code>docker-composeを</code>実行して、インストールを確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker-compose バージョン
docker-compose バージョン 1.21.0, ビルド不明
[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>docker-composeのコマンドでよく使うのはupとdownで、例えばdocker-compose upとします。</p>
</div>
</div>
<div class="sect3">
<h4 id="_docker_compose_configuration">docker-composeの設定</h4>
<div class="paragraph">
<p>docker-composeの設定ファイルは<em>code/docker</em>ディレクトリにあり、<em>docker-compose.ymlという</em>ファイル名になっています。ネットワークと4つのコンテナのそれぞれの仕様が書かれています。トップはこんな感じです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>のバージョンです。"3.3"
のネットワークに接続します。
  lnnet:

サービス
  bitcoind:
    コンテナ名: bitcoind
    ビルドします。
        コンテキスト: bitcoind
    イメージ: lnbook/bitcoind:latest
    ネットワーク
      - lnnet
    公開する。
      - "18443"
      - "12005"
      - "12006"

  アリス
    コンテナ名: アリス</pre>
</div>
</div>
<div class="paragraph">
<p>この例では、lnnetというネットワークと、lnnetネットワークに接続するbitcoindというコンテナを定義しています。コンテナは、本章の冒頭で作成したものと同じものです。コンテナのポートを3つ公開し、コンテナにコマンドを送信したり、ブロックやトランザクションを監視したりできるようにしています。次に、コンフィギュレーションでは "Alice" という LND コンテナを指定しています。さらに下には、"Bob"<code>(c-lightning</code>), "Chan" (Eclair), "Dina" (LND again) というコンテナの指定もあります。</p>
</div>
<div class="paragraph">
<p>これらの多様な実装は、BOLT仕様に準拠し、相互運用性のテストも十分に行われているため、ライトニングネットワークの構築に支障をきたすことはない。</p>
</div>
</div>
<div class="sect3">
<h4 id="_starting_the_example_lightning_network">例のライトニングネットワークの開始</h4>
<div class="paragraph">
<p>始める前に、すでに実行中のコンテナがないことを確認する必要があります。新しいコンテナがすでに起動しているコンテナと同じ名前を共有している場合、そのコンテナは起動に失敗します。必要に応じて、docker ps、docker stop、docker rmを使用して、現在実行中のコンテナを停止および削除してください。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">チップ</div>
</td>
<td class="content">
<div class="paragraph">
<p>これらのオーケストレーションされたDockerコンテナには同じ名前を使用しているため、名前の衝突を避けるために「クリーンアップ」が必要な場合があります。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph pagebreak-before">
<p>サンプルを起動するために、<em>docker-compose.yml</em>設定ファイルを含むディレクトリに切り替え、docker-compose upコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker-compose up
Chanの作成 ... 完了
Dinaの作成 ... done
bitcoindの作成 ... done
ボブの作成 ... done
Aliceの作成 ... done
Chan, Dina, Alice, bitcoind, Bob にアタッチする。
アリス｜bitcoindの開始を待っています...
ボブ｜bitcoindの開始を待つ...
Dina｜Waiting for bitcoind to start....
Chan｜Waiting for bitcoind to start....
bitcoind｜bitcoindの開始を待っています...
bitcoind｜bitcoindの開始を待っています。
bitcoind｜bitcoindを開始しました。
bitcoind｜ ======================================================================================================================

[...]

Chan｜eclairを起動中...
Dina｜lndを開始する...
Chan｜エクレールノード開始
アリス｜...ビットコインがブロックを採掘するのを待っています...
ボブ｜...ビットコインがブロックを採掘するのを待っています...
アリス｜lnd開始...
ボブ｜c-lightningを開始...

[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>起動後、各ノードが起動し、その進行状況を報告するため、一連のログファイルが表示されます。画面上ではかなりごちゃごちゃして見えるかもしれませんが、各出力行の先頭には、前に見たようにコンテナ名が付けられています。1つのコンテナからのログだけを見たい場合は、別のターミナルウィンドウで docker-compose logs コマンドを使用して f<em>(follow</em>) フラグと特定のコンテナ名を指定することで可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker-compose logs -f Alice</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_opening_channels_and_routing_a_payment">チャネルの開設と支払いのルーティング</h4>
<div class="paragraph">
<p>これで、私たちの Lightning ネットワークが稼働しているはずです。この章の前のセクションで見たように、docker execコマンドで実行中のDockerコンテナに対してコマンドを発行することができます。docker runでコンテナを起動したか、docker-compose upでコンテナの束を起動したかにかかわらず、Dockerコマンドを使用してコンテナに個別にアクセスすることができる。</p>
</div>
<div class="paragraph">
<p>支払いデモは、run-payment-demo.shというBashシェルスクリプトに含まれています。このデモを実行するには、お使いのコンピュータにBashシェルがインストールされている必要があります。ほとんどの Linux および Unix 系システム (例: macOS) には、bash がプリインストールされています。Windowsユーザーは、Windows Subsystem for Linuxをインストールし、UbuntuなどのLinuxディストリビューションを使用して、自分のコンピューターにネイティブなbashコマンドを取得することができます。</p>
</div>
<div class="paragraph">
<p>このスクリプトを実行してその効果を確認し、内部でどのように動作しているかを見てみましょう。コマンドとして実行するためにbashを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd code/docker
$ bash run-payment-demo.sh
支払いデモの開始
======================================================

ノード起動待ち
- bitcoind起動待ち...
- bitcoind採掘待ち...
- Alice 起動待ち...
- Bob起動待ち...
- Chan 起動待ち...
- Dina起動待ち...
全ノード起動完了
======================================================

ノードIDの取得
- アリス: 0335e200756e156f1e13c3b901e5ed5a28b01a3131cd0656a27ac5cc20d4e71129
- ボブ：033e9cb673b641d2541aa821c3f9214e8a11ada57451ed5a0eab2a4afbce7daa
- チャン: 02f2f12182f56c9f86b9aa7d08df89b79782210f0928cb361de51364695c7426
- Dina02d9354cec0458e0d6dee5cfa56b83040baddb4ff88ab64960e0244cc618b99bc3
======================================================

[...]

接続とチャネルの設定
- アリスからボブへ
- アリスノードからボブノードへの接続を開く

- 支払いチャンネルを作る アリス-&gt;ボブ


[...]

Dinaから10ksatsのインボイスをもらう
- ディナのインボイスです。
lnbcrt100u1psnuzzrpp5rz5dg4wy27973yr7ehwns5ldeusceqdaq0hguu8c29n4nsqkznjsdqqcqzpgxqyz5vqsp5vdpehw33fljnmmexa6ljk55544f3syd8nfttqlm3ljewu4r0q20q9qyyssqxh5nhkpjgfm47yxn4p9ecvndz7zddlsgpufnpyjl0kmnq227tdujlm0acdv39hcuqp2vhs40aav70c9yp0tee6tgzk8ut79mr877q0cpkjcfvr
======================================================

アリスからディナへの支払いを試みる
支払いに成功しました!</pre>
</div>
</div>
<div class="paragraph">
<p>出力からわかるように、このスクリプトはまず4つのノードそれぞれのノードID（公開鍵）を取得します。次に、各ノードを接続し、各ノードから次のノードへ1,000,000サトシのチャネルを設定します。最後に、ディナのノードから10,000サトシの請求書を発行し、アリスのノードからその請求書を支払う。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">チップ</div>
</td>
<td class="content">
<div class="paragraph">
<p>スクリプトが失敗した場合は、最初からもう一度実行してみてください。また、スクリプトにあるコマンドを一つずつ手動で発行して、その結果を見ることもできます。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このスクリプトには復習すべきことがたくさんありますが、基礎となる技術を理解することで、より多くの情報が明らかになるでしょう。後日、この例をもう一度ご覧になってみてください。</p>
</div>
<div class="paragraph">
<p>もちろん、このテストネットワークでは、3チャンネル、4ノードの支払いよりも多くのことを行うことができます。ここでは、あなたの実験のためのいくつかのアイデアを紹介します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>さらに多くの異なるタイプのノードを起動することで、より複雑なネットワークを作成します。<em>docker-compose.yml</em>ファイルを編集してセクションをコピーし、必要に応じてコンテナの名前を変更します。</p>
</li>
<li>
<p>循環ルート、ハブ＆スポーク、フルメッシュなど、より複雑なトポロジーでノードを接続します。</p>
</li>
<li>
<p>チャンネルの容量を使い切るために多くの支払いを実行します。次に、反対方向に支払いを実行し、チャネルのバランスを調整する。ルーティングアルゴリズムがどのように適応するかを見てみましょう。</p>
</li>
<li>
<p>ルーティングアルゴリズムが複数のルートをどのように交渉し、どのような最適化を適用するかを確認するために、チャンネル料金を変更します。安くて長いルートは、高くて短いルートよりも良いのでしょうか？</p>
</li>
<li>
<p>あるノードから自分自身への循環支払を実行して、そのノード自身のチャネルのバランスを調整します。他のチャンネルやノードにどのような影響を与えるか見てみましょう。</p>
</li>
<li>
<p>ループ内で数百、数千の小額請求書を生成し、別のループ内で可能な限り高速に支払いを行う。このテストネットワークから1秒間にどれだけのトランザクションを絞り出すことができるかを測定します。</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">チップ</div>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://lightningpolar.com">Lightning Polarは</a>、Dockerを使って実験しているネットワークを可視化することができます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">結論</h3>
<div class="paragraph">
<p>この章では、BOLT仕様を実装した様々なプロジェクトを見てきました。サンプルのLightningネットワークを実行するためのコンテナを構築し、ソースコードから各プロジェクトを構築する方法を学びました。これで、さらに探求し、深く掘り下げる準備が整いました。</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
最終更新 2022-10-29 15:50:16 +0400
</div>
</div>
</body>
</html>