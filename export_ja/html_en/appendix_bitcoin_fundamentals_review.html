<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Bitcoin Fundamentals Review</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="bitcoin_fundamentals_review">Appendix A: Bitcoin Fundamentals Review</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Lightning Network is capable of running above multiple blockchains, but is primarily anchored on Bitcoin. To understand the Lightning Network, you need a fundamental understanding of Bitcoin and its building blocks.</p>
</div>
<div class="paragraph">
<p>There are many good resources that you can use to learn more about Bitcoin, including the companion book <em>Mastering Bitcoin</em>, 2nd Edition, by Andreas M. Antonopoulos, which you can find on GitHub under <a href="https://github.com/bitcoinbook/bitcoinbook">an open source license</a>. However, you do not need to read a whole other book to be ready for this one!</p>
</div>
<div class="paragraph">
<p>In this chapter, we&#8217;ve collected the most important concepts you need to know about Bitcoin and explained them in the context of the Lightning Network. This way you can learn exactly what you need to know to grasp the Lightning Network without any distractions.</p>
</div>
<div class="paragraph">
<p>This chapter covers several important concepts from Bitcoin, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keys and digital signatures</p>
</li>
<li>
<p>Hash functions</p>
</li>
<li>
<p>Bitcoin transactions and their structure</p>
</li>
<li>
<p>Bitcoin transaction chaining</p>
</li>
<li>
<p>Transaction outpoints</p>
</li>
<li>
<p>Bitcoin Script: locking and unlocking scripts</p>
</li>
<li>
<p>Basic locking scripts</p>
</li>
<li>
<p>Complex and conditional locking scripts</p>
</li>
<li>
<p>Timelocks</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_keys_and_digital_signatures">Keys and Digital Signatures</h3>
<div class="paragraph">
<p>You may have heard that bitcoin is based on <em>cryptography</em>, which is a branch of mathematics used extensively in computer security. Cryptography can also be used to prove knowledge of a secret without revealing that secret (digital signature), or prove the authenticity of data (digital fingerprint). These types of cryptographic proofs are the mathematical tools critical to Bitcoin and used extensively in Bitcoin applications.</p>
</div>
<div class="paragraph">
<p>Ownership of bitcoin is established through <em>digital keys</em>, <em>bitcoin addresses</em>, and <em>digital signatures</em>. The digital keys are not actually stored in the network, but are instead created and stored by users in a file, or simple database, called a <em>wallet</em>. The digital keys in a user&#8217;s wallet are completely independent of the Bitcoin Protocol and can be generated and managed by the user&#8217;s wallet software without reference to the blockchain or access to the internet.</p>
</div>
<div class="paragraph">
<p>Most Bitcoin transactions require a valid digital signature to be included in the blockchain, which can only be generated with a secret key; therefore, anyone with a copy of that key has control of the bitcoin.  The digital signature used to spend funds is also referred to as a <em>witness</em>, a term used in cryptography. The witness data in a bitcoin transaction testifies to the true ownership of the funds being spent. Keys come in pairs consisting of a private (secret) key and a public key. Think of the public key as similar to a bank account number and the private key as similar to the secret PIN.</p>
</div>
<div class="sect3">
<h4 id="_private_and_public_keys">Private and Public Keys</h4>
<div class="paragraph">
<p>A private key is simply a number, picked at random. In practice, and to make managing many keys easy, most Bitcoin wallets generate a sequence of private keys from a single random <em>seed</em> using a deterministic derivation algorithm. Simply put, a single random number is used to produce a repeatable sequence of seemingly random numbers that are used as private keys. This allows users to only back up the seed and be able to <em>derive</em> all the keys they need from that seed.</p>
</div>
<div class="paragraph">
<p>Bitcoin, like many other cryptocurrencies and blockchains, uses <em>elliptic curves</em> for security. In Bitcoin, elliptic curve multiplication on the <em>secp256k1</em> elliptic curve is used as a <em>one-way function</em>. Simply put, the nature of elliptic curve math makes it trivial to calculate the scalar multiplication of a point but impossible to calculate the inverse (division, or discrete logarithm).</p>
</div>
<div class="paragraph">
<p>Each private key has a corresponding <em>public key</em>, which is calculated from the private key, using scalar multiplication on the elliptic curve. In simple terms, with a private key <em>k</em>, we can multiply it with a constant <em>G</em> to produce a public key <em>K</em>:</p>
</div>
<ul class="simplelist">
<li><em>K</em> = <em>k</em>*<em>G</em></li>
</ul>
<div class="paragraph">
<p>It is impossible to reverse this calculation. Given a public key <em>K</em>, one cannot calculate the private key <em>k</em>. Division by <em>G</em> is not possible in elliptic curve math. Instead, one would have to try all possible values of <em>k</em> in an exhaustive process called a <em>brute-force attack</em>. Because <em>k</em> is a 256-bit number, exhausting all possible values with any classical computer would require more time and energy than available in this universe.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hashes">Hashes</h4>
<div class="paragraph">
<p>Another important tool used extensively in Bitcoin, and in the Lightning Network, are <em>cryptographic hash functions</em>, and specifically the SHA-256 hash function.</p>
</div>
<div class="paragraph">
<p>A hash function, also known as a <em>digest function</em>, is a function that takes arbitrary length data and transforms it into a fixed length result, called the <em>hash</em>, <em>digest</em>, or <em>fingerprint</em> (see <a href="#SHA256">The SHA-256 cryptographic hash algorithm</a>). Importantly, hash functions are <em>one-way</em> functions, meaning that you can&#8217;t reverse them and calculate the input data from the fingerprint.</p>
</div>
<div id="SHA256" class="imageblock">
<div class="content">
<img src="images/mtln_aa01.png" alt="The SHA-256 cryptographic hash algorithm">
</div>
<div class="title">Figure 1. The SHA-256 cryptographic hash algorithm</div>
</div>
<div class="paragraph pagebreak-before">
<p>For example, if we use a command-line terminal to feed the text "Mastering the Lightning Network" into the SHA-256 function, it will produce a fingerprint as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ echo -n "Mastering the Lightning Network" | shasum -a 256

ce86e4cd423d80d054b387aca23c02f5fc53b14be4f8d3ef14c089422b2235de  -</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The input used to calculate a hash is also called a <em>preimage</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The length of the input can be much bigger, of course. Let&#8217;s try the same thing with the <a href="https://bitcoin.org/bitcoin.pdf">PDF file of the Bitcoin whitepaper</a> from Satoshi Nakamoto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ wget http://bitcoin.org/bitcoin.pdf
$ cat bitcoin.pdf | shasum -a 256
b1674191a88ec5cdd733e4240a81803105dc412d6c6708d53ab94fc248f4f553  -</pre>
</div>
</div>
<div class="paragraph">
<p>While it takes longer than a single sentence, the SHA-256 function processes the 9-page PDF, "digesting" it into a 256-bit fingerprint.</p>
</div>
<div class="paragraph">
<p>Now at this point you might be wondering how it is possible for a function that digests data of unlimited size to produce a unique fingerprint that is a fixed-size number?</p>
</div>
<div class="paragraph">
<p>In theory, since there is an infinite number of possible preimages (inputs) and only a finite number of fingerprints, there must be many preimages that produce the same 256-bit fingerprint. When two preimages produce the same hash, this is known as a <em>collision</em>.</p>
</div>
<div class="paragraph">
<p>In practice, a 256-bit number is so large that you will never find a collision on purpose. Cryptographic hash functions work on the basis that a search for a collision is a brute-force effort that takes so much energy and time that it is not practically possible.</p>
</div>
<div class="paragraph">
<p>Cryptographic hash functions are broadly used in a variety of applications because they have some useful features. They are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Deterministic</dt>
<dd>
<p>The same input always produces the same hash.</p>
</dd>
<dt class="hdlist1">Irreversible</dt>
<dd>
<p>It is not possible to compute the preimage of a hash.</p>
</dd>
<dt class="hdlist1">Collision-proof</dt>
<dd>
<p>It is computationally infeasible to find two messages that have the same hash.</p>
</dd>
<dt class="hdlist1">Uncorrelated</dt>
<dd>
<p>A small change in the input produces such a big change in the output that the output seems uncorrelated to the input.</p>
</dd>
<dt class="hdlist1">Uniform/random</dt>
<dd>
<p>A cryptographic hash function produces hashes that are uniformly distributed across the entire 256-bit space of possible outputs. The output of a hash appears to be random, though it is not truly random.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Using these features of cryptographic hashes, we can build some interesting <span class="keep-together">applications</span>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Fingerprints</dt>
<dd>
<p>A hash can be used to fingerprint a file or message so that it can be uniquely identified. Hashes can be used as universal identifiers of any data set.</p>
</dd>
<dt class="hdlist1">Integrity proof</dt>
<dd>
<p>A fingerprint of a file or message demonstrates its integrity because the file or message cannot be tampered with or modified in any way without changing the fingerprint. This is often used to ensure software has not been tampered with before installing it on your computer.</p>
</dd>
<dt class="hdlist1">Commitment/nonrepudiation</dt>
<dd>
<p>You can commit to a specific preimage (e.g., a number or message) without revealing it by publishing its hash. Later, you can reveal the secret, and everyone can verify that it is the same thing you committed to earlier because it produces the published hash.</p>
</dd>
<dt class="hdlist1">Proof-of-work/hash grinding</dt>
<dd>
<p>You can use a hash to prove you have done computational work by showing a nonrandom pattern in the hash which can only be produced by repeated guesses at a preimage. For example, the hash of a Bitcoin block header starts with a lot of zero bits. The only way to produce it is by changing a part of the header and hashing it trillions of times until it produces that pattern by chance.</p>
</dd>
<dt class="hdlist1">Atomicity</dt>
<dd>
<p>You can make a secret preimage a prerequisite of spending funds in several linked transactions. If any one of the parties reveals the preimage in order to spend one of the transactions, all the other parties can now spend their transactions too. All or none become spendable, achieving atomicity across several transactions.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_digital_signatures">Digital Signatures</h4>
<div class="paragraph">
<p>The private key is used to create signatures that are required to spend bitcoin by proving ownership of funds used in a transaction.</p>
</div>
<div class="paragraph">
<p>A <em>digital signature</em> is a number that is calculated from the application of the private key to a specific message.</p>
</div>
<div class="paragraph">
<p>Given a message <em>m</em> and a private key <em>k</em>, a signature function <em>F<sub>sign</sub></em> can produce a signature <em>S</em>:</p>
</div>
<div class="stemblock">
<div class="content">
\[$ S = F_{sign}(m, k) $\]
</div>
</div>
<div class="paragraph">
<p>This signature <em>S</em> can be independently verified by anyone who has the public key <em>K</em> (corresponding to private key <em>k</em>), and the message:</p>
</div>
<div class="stemblock">
<div class="content">
\[$ F_{verify}(m, K, S) $\]
</div>
</div>
<div class="paragraph">
<p>If <em>F<sub>verify</sub></em> returns a true result, then the verifier can confirm that the message <em>m</em> was signed by someone who had access to the private key <em>k</em>. Importantly, the digital signature proves the possession of the private key <em>k</em> at the time of signing, without revealing <em>k</em>.</p>
</div>
<div class="paragraph">
<p>Digital signatures use a cryptographic hash algorithm. The signature is applied to a hash of the message, so that the message <em>m</em> is "summarized" to a fixed-length hash <em>H</em>(<em>m</em>) that serves as a fingerprint.</p>
</div>
<div class="paragraph">
<p>By applying the digital signature on the hash of a transaction, the signature not only proves the authorization, but also "locks" the transaction data, ensuring its integrity. A signed transaction cannot be modified because any change would result in a different hash and invalidate the signature.</p>
</div>
</div>
<div class="sect3">
<h4 id="_signature_types">Signature Types</h4>
<div class="paragraph">
<p>Signatures are not always applied to the entire transaction. To provide signing flexibility, a Bitcoin digital signature contains a prefix called the signature hash type, which specifies which part of the transaction data is included in the hash. This allows the signature to commit or "lock" all, or only some of, the data in the transaction. The most common signature hash type is SIGHASH_ALL which locks everything in the transaction by including all the transaction data in the hash that is signed. By comparison, SIGHASH_SINGLE locks all the transaction inputs, but only one output (more about inputs and outputs in the next section). Different signature hash types can be combined to produce six different "patterns" of transaction data that are locked by the signature.</p>
</div>
<div class="paragraph">
<p>More information about signature hash types can be found in <a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch06.asciidoc#sighash_types">the section "Signature Hash Types" in Chapter 6 of <em>Mastering Bitcoin</em>, Second Edition</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bitcoin_transactions">Bitcoin Transactions</h3>
<div class="paragraph">
<p><em>Transactions</em> are data structures that encode the transfer of value between participants in the bitcoin system.</p>
</div>
<div class="sect3">
<h4 id="utxo">Inputs and Outputs</h4>
<div class="paragraph">
<p>The fundamental building block of a bitcoin transaction is a transaction output. <em>Transaction outputs</em> are indivisible chunks of bitcoin currency, recorded on the blockchain, and recognized as valid by the entire network. A transaction spends inputs and creates outputs. Transaction <em>inputs</em> are simply references to outputs of previously recorded transactions. This way, each transaction spends the outputs of previous transactions and creates new outputs (see <a href="#transaction_structure">A transaction transfers value from inputs to outputs</a>).</p>
</div>
<div id="transaction_structure" class="imageblock">
<div class="content">
<img src="images/mtln_aa02.png" alt="transaction inputs and outputs">
</div>
<div class="title">Figure 2. A transaction transfers value from inputs to outputs</div>
</div>
<div class="paragraph">
<p>Bitcoin full nodes track all available and spendable outputs, known as <em>unspent transaction outputs</em> (UTXOs). The collection of all UTXOs is known as the UTXO set, which currently numbers in the millions of UTXOs. The UTXO set grows as new UTXOs are created and shrinks when UTXOs are consumed. Every transaction represents a change (state transition) in the UTXO set, by consuming one or more UTXOs as <em>transaction inputs</em> and creating one or more UTXOs as its <em>transaction outputs</em>.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s assume that a user Alice has a 100,000 satoshi UTXO that she can spend. Alice can pay Bob 100,000 satoshi by constructing a transaction with one input (consuming her existing 100,000 satoshi input) and one output that "pays" Bob 100,000 satoshi. Now Bob has a 100,000 satoshi UTXO that he can spend, creating a new transaction that consumes this new UTXO and spends it to another UTXO as a payment to another user, and so on (see <a href="#alice_100ksat_to_bob">Alice pays 100,000 satoshis to Bob</a>).</p>
</div>
<div id="alice_100ksat_to_bob" class="imageblock">
<div class="content">
<img src="images/mtln_aa03.png" alt="Alice pays 100,000 satoshis to Bob">
</div>
<div class="title">Figure 3. Alice pays 100,000 satoshis to Bob</div>
</div>
<div class="paragraph">
<p>A transaction output can have an arbitrary (integer) value denominated in satoshis. Just as dollars can be divided down to two decimal places as cents, bitcoin can be divided down to eight decimal places as satoshis. Although an output can have any arbitrary value, once created it is indivisible. This is an important characteristic of outputs that needs to be emphasized: outputs are discrete and indivisible units of value, denominated in integer satoshis. An unspent output can only be consumed in its entirety by a transaction.</p>
</div>
<div class="paragraph">
<p>So what if Alice wants to pay Bob 50,000 satoshi, but only has an indivisible 100,000 satoshi UTXO? Alice will need to create a transaction that consumes (as its input) the 100,000 satoshi UTXO and has two outputs: one paying 50,000 satoshi to Bob and one paying 50,000 satoshi <em>back</em> to Alice as "change" (see <a href="#alice_50ksat_to_bob_change">Alice pays 50k sat to Bob and 50k sat to herself as change</a>).</p>
</div>
<div id="alice_50ksat_to_bob_change" class="imageblock">
<div class="content">
<img src="images/mtln_aa04.png" alt="Alice pays 50,000 satoshis to Bob and 50,000 satoshis to herself as change">
</div>
<div class="title">Figure 4. Alice pays 50k sat to Bob and 50k sat to herself as change</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>There&#8217;s nothing special about a change output or any way to distinguish it from any other output. It doesn&#8217;t have to be the last output. There could be more than one change output, or no change outputs. Only the creator of the transaction knows which outputs are to others and which outputs are to addresses they own and therefore "change."</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly, if Alice wants to pay Bob 85,000 satoshi but has two 50,000 satoshi UTXOs available, she has to create a transaction with two inputs (consuming both her 50,000 satoshi UTXOs) and two outputs, paying Bob 85,000 and sending 15,000 satoshi back to herself as change (see <a href="#tx_twoin_twoout">Alice uses two 50k inputs to pay 85k sat to Bob and 15k sat to herself as change</a>).</p>
</div>
<div id="tx_twoin_twoout" class="imageblock">
<div class="content">
<img src="images/mtln_aa05.png" alt="Alice uses two 50k inputs to pay 85k sat to Bob and 15k sat to herself as change">
</div>
<div class="title">Figure 5. Alice uses two 50k inputs to pay 85k sat to Bob and 15k sat to herself as change</div>
</div>
<div class="paragraph">
<p>The preceding illustrations and examples show how a Bitcoin transaction combines (spends) one or more inputs and creates one or more outputs. A transaction can have hundreds or even thousands of inputs and outputs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>While the transactions created by the Lightning Network have multiple outputs, they do not have "change" per se, because the entire available balance of a channel is split between the two channel partners.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_transaction_chains">Transaction Chains</h4>
<div class="paragraph">
<p>Every output can be spent as an input in a subsequent transaction. So, for example, if Bob decided to spend 10,000 satoshi in a transaction paying Chan, and Chan spent 4,000 satoshi to pay Dina, it would play out as shown in <a href="#tx_chain">Alice pays Bob who pays Chan who pays Dina</a>.</p>
</div>
<div class="paragraph">
<p>An output is considered <em>spent</em> if it is referenced as an input in another transaction that is recorded on the blockchain. An output is considered <em>unspent</em> (and available for spending) if no recorded transaction references it.</p>
</div>
<div class="paragraph">
<p>The only type of transaction that doesn&#8217;t have inputs is a special transaction created by Bitcoin miners called the <em>coinbase transaction</em>. The coinbase transaction has only outputs and no inputs because it creates new bitcoin from mining. Every other transaction spends one or more previously recorded outputs as its inputs.</p>
</div>
<div class="paragraph">
<p>Since transactions are chained, if you pick a transaction at random, you can follow any one of its inputs backward to the previous transaction that created it. If you keep doing that, you will eventually reach a coinbase transaction where the bitcoin was first mined.</p>
</div>
<div id="tx_chain" class="imageblock">
<div class="content">
<img src="images/mtln_aa06.png" alt="Alice pays Bob who pays Chan who pays Dina">
</div>
<div class="title">Figure 6. Alice pays Bob who pays Chan who pays Dina</div>
</div>
</div>
<div class="sect3">
<h4 id="_txid_transaction_identifiers">TxID: Transaction Identifiers</h4>
<div class="paragraph">
<p>Every transaction in the Bitcoin system is identified by a unique identifier (assuming the existence of BIP-0030), called the <em>transaction ID</em> or <em>TxID</em> for short. To produce a unique identifier, we use the SHA-256 cryptographic hash function to produce a hash of the transaction&#8217;s data. This "fingerprint" serves as a universal identifier. A transaction can be referenced by its transaction ID, and once a transaction is recorded on the Bitcoin blockchain, every node in the Bitcoin network knows that this transaction is valid.</p>
</div>
<div class="paragraph">
<p>For example, a transaction ID might look like this:</p>
</div>
<div class="listingblock">
<div class="title">A transaction ID produced from hashing the transaction data</div>
<div class="content">
<pre>e31e4e214c3f436937c74b8663b3ca58f7ad5b3fce7783eb84fd9a5ee5b9a54c</pre>
</div>
</div>
<div class="paragraph">
<p>This is a real transaction (created as an example for the <em>Mastering Bitcoin</em> book) that can be found on the Bitcoin blockchain. Try to find it by entering this TxID into a block explorer:</p>
</div>
<ul class="simplelist">
<li><a href="https://blockstream.info/tx/e31e4e214c3f436937c74b8663b3ca58f7ad5b3fce7783eb84fd9a5ee5b9a54c"><em>https://blockstream.info/tx/e31e4e214c3f436937c74b8663b3ca58f7ad5b3fce7783eb84fd9a5ee5b9a54c</em></a></li></ul>
<div class="paragraph">
<p>or use the short link (case-sensitive):</p>
</div>
<ul class="simplelist">
<li><a href="http://bit.ly/AliceTx"><em>http://bit.ly/AliceTx</em></a></li>
</ul>
</div>
<div class="sect3">
<h4 id="_outpoints_output_identifiers">Outpoints: Output Identifiers</h4>
<div class="paragraph">
<p>Because every transaction has a unique ID, we can also identify a transaction output within that transaction uniquely by reference to the TxID and the output index number. The first output in a transaction is output index 0, the second output is output index 1, and so on. An output identifier is commonly known as an <em>outpoint</em>.</p>
</div>
<div class="paragraph">
<p>By convention we write an outpoint as the TxID, a colon, and the output index number:</p>
</div>
<div class="listingblock">
<div class="title">A outpoint: identifying an output by TxID and index number</div>
<div class="content">
<pre>7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18:0</pre>
</div>
</div>
<div class="paragraph">
<p>Output identifiers (outpoints) are the mechanisms that link transactions together in a chain. Every transaction input is a reference to a specific output of a previous transaction. That reference is an outpoint: a TxID and output index number. So a transaction "spends" a specific output (by index number) from a specific transaction (by TxID) to create new outputs that themselves can be spent by reference to the outpoint.</p>
</div>
<div class="paragraph">
<p><a href="#tx_chain_vout">Transaction inputs refer to outpoints forming a chain</a> presents the chain of transactions from Alice to Bob to Chan to Dina, this time with outpoints in each of the inputs.</p>
</div>
<div id="tx_chain_vout" class="imageblock">
<div class="content">
<img src="images/mtln_aa07.png" alt="Transaction inputs refer to outpoints forming a chain">
</div>
<div class="title">Figure 7. Transaction inputs refer to outpoints forming a chain</div>
</div>
<div class="paragraph">
<p>The input in Bob&#8217;s transaction references Alice&#8217;s transaction (by TxID) and the 0 indexed output.</p>
</div>
<div class="paragraph">
<p>The input in Chan&#8217;s transaction references Bob&#8217;s transaction&#8217;s TxID and the first indexed output, because the payment to Chan is output #1. In Bob&#8217;s payment to Chan, Bob&#8217;s change is output #0.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="paragraph">
<p>Now, if we look at Alice&#8217;s payment to Bob, we can see that Alice is spending an outpoint that was the third (output index #2) output in a transaction whose ID is 6a5f1b3[&#8230;&#8203;]. We don&#8217;t see that referenced transaction in the diagram, but we can deduce these details from the outpoint.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bitcoin_script">Bitcoin Script</h3>
<div class="paragraph">
<p>The final element of Bitcoin that is needed to complete our understanding is the scripting language that controls access to outpoints. So far, we&#8217;ve simplified the description by saying "Alice signs the transaction to pay Bob." Behind the scenes, however, there is some hidden complexity that makes it possible to implement more complex spending conditions. The simplest and most common spending condition is "present a signature matching the following public key." A spending condition like this is recorded in each output as <em>locking script</em> written in a scripting language called <em>Bitcoin Script</em>.</p>
</div>
<div class="paragraph">
<p>Bitcoin Script is an extremely simple stack-based scripting language. It does not contain loops or recursion and therefore is <em>Turing incomplete</em> (meaning it cannot express arbitrary complexity and has predictable execution). Those familiar with the (now ancient) programming language FORTH will recognize the syntax and style.</p>
</div>
<div class="sect3">
<h4 id="_running_bitcoin_script">Running Bitcoin Script</h4>
<div class="paragraph">
<p>In simple terms, the Bitcoin system evaluates Bitcoin Script by running the script on a stack; if the final result is TRUE, it considers the spending condition satisfied and the transaction valid.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a very simple example of Bitcoin Script, which adds the numbers 2 and 3 and then compares the result to the number 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2 3 ADD 5 EQUAL</pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="#figa08">Example of Bitcoin Script execution</a>, we see how this script is executed (from left to right).</p>
</div>
<div id="figa08" class="imageblock">
<div class="content">
<img src="images/mtln_aa08.png" alt="Example of Bitcoin Script execution">
</div>
<div class="title">Figure 8. Example of Bitcoin Script execution</div>
</div>
</div>
<div class="sect3 pagebreak-before less_space">
<h4 id="_locking_and_unlocking_scripts">Locking and Unlocking Scripts</h4>
<div class="paragraph">
<p>Bitcoin Script is made up of two parts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Locking scripts</dt>
<dd>
<p>These are embedded in transaction outputs, setting the conditions that must be fulfilled to spend that output. For example, Alice&#8217;s wallet adds a locking script to the output paying Bob, that sets the condition that Bob&#8217;s signature is required to spend it.</p>
</dd>
<dt class="hdlist1">Unlocking scripts</dt>
<dd>
<p>These are embedded in transaction inputs, fulfilling the conditions set by the referenced output&#8217;s locking script. For example, Bob can unlock the preceding output by providing an unlocking script containing a digital signature.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Using a simplified model, for validation, the unlocking script and locking script are concatenated and executed (P2SH and SegWit are exceptions). For example, if someone locked a transaction output with the locking script "3 ADD 5 EQUAL", we could spend it with the unlocking script "2" in a transaction input. Anyone validating that transaction would concatenate our unlocking script (2) and the locking script (3 ADD 5 EQUAL) and run the result through the Bitcoin Script execution engine. They would get TRUE and we would be able to spend the output.</p>
</div>
<div class="paragraph">
<p>Obviously, this simplified example would make a very poor choice for locking an actual Bitcoin output because there is no secret, just basic arithmetic. Anyone could spend the output by providing the answer "2." Most locking scripts therefore require demonstrating knowledge of a secret.</p>
</div>
</div>
<div class="sect3">
<h4 id="_locking_to_a_public_key_signature">Locking to a Public Key (Signature)</h4>
<div class="paragraph">
<p>The simplest form of a locking script is one that requires a signature. Let&#8217;s consider Alice&#8217;s transaction that pays Bob 50,000 satoshis. The output Alice creates to pay Bob will have a locking script requiring Bob&#8217;s signature and would look like this:</p>
</div>
<div id="bob_locking_script" class="listingblock">
<div class="title">A locking script that requires a digital signature from Bob&#8217;s private key</div>
<div class="content">
<pre>&lt;Bob Public Key&gt; CHECKSIG</pre>
</div>
</div>
<div class="paragraph">
<p>The operator <code>CHECKSIG</code> takes two items from the stack: a signature and a public key. As you can see, Bob&#8217;s public key is in the locking script, so what is missing is the signature corresponding to that public key. This locking script can only be spent by Bob, because only Bob has the corresponding private key needed to produce a digital signature matching the public key.</p>
</div>
<div class="paragraph">
<p>To unlock this locking script, Bob would provide an unlocking script containing only his digital signature:</p>
</div>
<div id="bob_unlocking_script" class="listingblock">
<div class="title">An unlocking script containing (only) a digital signature from Bob&#8217;s private key</div>
<div class="content">
<pre>&lt;Bob Signature&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="#locking_unlocking_chain">A transaction chain showing the locking script (output) and unlocking script (input)</a> you can see the locking script in Alice&#8217;s transaction (in the output that pays Bob) and the unlocking script (in the input that spends that output) in Bob&#8217;s transaction.</p>
</div>
<div id="locking_unlocking_chain" class="imageblock">
<div class="content">
<img src="images/mtln_aa09.png" alt="A transaction chain showing the locking script (output) and unlocking script (input)">
</div>
<div class="title">Figure 9. A transaction chain showing the locking script (output) and unlocking script (input)</div>
</div>
<div class="paragraph">
<p>To validate Bob&#8217;s transaction, a Bitcoin node would do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extract the unlocking script from the input (&lt;Bob Signature&gt;).</p>
</li>
<li>
<p>Look up the outpoint it is attempting to spend (a643e37...3213:0). This is Alice&#8217;s transaction and would be found on the blockchain.</p>
</li>
<li>
<p>Extract the locking script from that outpoint (&lt;Bob PubKey&gt; CHECKSIG).</p>
</li>
<li>
<p>Concatenate into one script, placing the unlocking script in front of the locking script (&lt;Bob Signature&gt; &lt;Bob PubKey&gt; CHECKSIG).</p>
</li>
<li>
<p>Execute this script on the Bitcoin Script execution engine to see what result is produced.</p>
</li>
<li>
<p>If the result is TRUE, deduce that Bob&#8217;s transaction is valid because it was able to fulfill the spending condition to spend that outpoint.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_locking_to_a_hash_secret">Locking to a Hash (Secret)</h4>
<div class="paragraph">
<p>Another type of locking script, one that is used in the Lightning Network, is a <em>hashlock</em>. To unlock it, you must know the secret <em>preimage</em> to the hash.</p>
</div>
<div class="paragraph">
<p>To demonstrate this, let&#8217;s have Bob generate a random number R and keep it secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>R = 1833462189</pre>
</div>
</div>
<div class="paragraph pagebreak-before">
<p>Now, Bob calculates the SHA-256 hash of this number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>H = SHA256(R) =&gt;
H = SHA256(1833462189) =&gt;
H = 0ffd8bea4abdb0deafd6f2a8ad7941c13256a19248a7b0612407379e1460036a</pre>
</div>
</div>
<div class="paragraph">
<p>Now, Bob gives the hash H we calculated previously to Alice, but keeps the number R secret. Recall that because of the properties of cryptographic hashes, Alice can&#8217;t "reverse" the hash calculation and guess the number R.</p>
</div>
<div class="paragraph">
<p>Alice creates an output paying 50,000 satoshi with the locking script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HASH256 H EQUAL</pre>
</div>
</div>
<div class="paragraph">
<p>where H is the actual hash value (0ffd8...036a) that Bob gave to Alice.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s explain this script:</p>
</div>
<div class="paragraph">
<p>The HASH256 operator pops a value from the stack and calculates the SHA-256 hash of that value. Then it pushes the result onto the stack.</p>
</div>
<div class="paragraph">
<p>The H value is pushed onto the stack, and then the EQUAL operator checks if the two values are the same and pushes TRUE or FALSE onto the stack accordingly.</p>
</div>
<div class="paragraph">
<p>Therefore, this locking script will only work if it is combined with an unlocking script that contains R, so that when concatenated, we have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>R HASH256 H EQUAL</pre>
</div>
</div>
<div class="paragraph">
<p>Only Bob knows R, so only Bob can produce a transaction with an unlocking script revealing the secret value R.</p>
</div>
<div class="paragraph">
<p>Interestingly, Bob can give the R value to anyone else, who can then spend that Bitcoin. This makes the secret value R almost like a bitcoin "voucher," since anyone who has it can spend the output Alice created. We&#8217;ll see how this is a useful property for the Lightning Network!</p>
</div>
</div>
<div class="sect3">
<h4 id="multisig">Multisignature Scripts</h4>
<div class="paragraph">
<p>The Bitcoin Script language provides a multisignature building block (primitive), that can be used to build escrow services and complex ownership configurations between several stakeholders. An arrangement that requires multiple signatures to spend Bitcoin is called a <em>multisignature scheme</em>, further specified as a <em>K-of-N</em> scheme, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>N</em> is the total number of signers identified in the multisignature scheme, and</p>
</li>
<li>
<p><em>K</em> is the <em>quorum</em> or <em>threshold</em>: the minimum number of signatures to authorize spending.</p>
</li>
</ul>
</div>
<div class="paragraph pagebreak-before">
<p>The script for an <em>K</em>-of-<em>N</em> multisignature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>K &lt;PubKey1&gt; &lt;PubKey2&gt; ... &lt;PubKeyN&gt; N CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph">
<p>where <em>N</em> is the total number of listed public keys (Public Key 1 through Public Key <em>N</em>) and <em>K</em> is the threshold of required signatures to spend the output.</p>
</div>
<div class="paragraph">
<p>The Lightning Network uses a 2-of-2 multisignature scheme to build a payment channel. For example, a payment channel between Alice and Bob would be built on a 2-of-2 multisignature like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2 &lt;PubKey Alice&gt; &lt;PubKey Bob&gt; 2 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph">
<p>The preceding locking script can be satisfied with an unlocking script containing a pair of signatures:<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 &lt;Sig Alice&gt; &lt;Sig Bob&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The two scripts together would form the combined validation script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 &lt;Sig Alice&gt; &lt;Sig Bob&gt; 2 &lt;PubKey Alice&gt; &lt;PubKey Bob&gt; 2 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph">
<p>A multisignature locking script can be represented by a Bitcoin address, encoding the hash of the locking script. For example, the initial funding transaction of a Lightning payment channel is a transaction that pays to an address that encodes a locking script of a 2-of-2 multisig of the two channel partners.</p>
</div>
</div>
<div class="sect3">
<h4 id="_timelock_scripts">Timelock Scripts</h4>
<div class="paragraph">
<p>Another important building block that exists in Bitcoin and is used extensively in the Lightning Network is a <em>timelock</em>. A timelock is a restriction on spending that requires that a certain time or block height has elapsed before spending is allowed. It is a bit like a postdated check drawn from a bank account that can&#8217;t be cashed before the date on the check.</p>
</div>
<div class="paragraph">
<p>Bitcoin has two levels of timelocks: transaction-level timelocks and output-level timelocks.</p>
</div>
<div class="paragraph">
<p>A <em>transaction-level timelock</em> is recorded in the transaction <code>nLockTime</code> field of the transaction and prevents the entire transaction from being accepted before the timelock has passed. Transaction-level timelocks are the most commonly used timelock mechanism in Bitcoin today.</p>
</div>
<div class="paragraph">
<p>An <em>output-level timelock</em> is created by a script operator. There are two types of output timelocks: absolute timelocks and relative timelocks.</p>
</div>
<div class="paragraph">
<p>Output-level <em>absolute timelocks</em> are implemented by the operator CHECKLOCKTIMEVERIFY, which is often shortened in conversation as <em>CLTV</em>. Absolute timelocks implement a time constraint with an absolute timestamp or blockheight, expressing the equivalent of "not spendable before block 800,000."</p>
</div>
<div class="paragraph">
<p>Output-level <em>relative timelocks</em> are implemented by the operator CHECKSEQUENCEVERIFY, often shortened in conversation as <em>CSV</em>. Relative timelocks implement a spending constraint that is relative to the confirmation of the transaction, expressing the equivalent of "can&#8217;t be spent until 1,024 blocks after confirmation."</p>
</div>
</div>
<div class="sect3">
<h4 id="conditional_scripts">Scripts with Multiple Conditions</h4>
<div class="paragraph">
<p>One of the more powerful features of Bitcoin Script is flow control, also known as conditional clauses. You are probably familiar with flow control in various programming languages that use the construct IF...THEN...ELSE. Bitcoin conditional clauses look a bit different, but are essentially the same construct.</p>
</div>
<div class="paragraph">
<p>At a basic level, bitcoin conditional opcodes allow us to construct a locking script that has two ways of being unlocked, depending on a TRUE/FALSE outcome of evaluating a logical condition. For example, if x is TRUE, the locking script is A ELSE the locking script is B.</p>
</div>
<div class="paragraph">
<p>Additionally, bitcoin conditional expressions can be <em>nested</em> indefinitely, meaning that a conditional clause can contain another within it, which contains another, etc. Bitcoin Script flow control can be used to construct very complex scripts with hundreds or even thousands of possible execution paths. There is no limit to nesting, but consensus rules impose a limit on the maximum size, in bytes, of a script.</p>
</div>
<div class="paragraph">
<p>Bitcoin implements flow control using the IF, ELSE, ENDIF, and NOTIF opcodes. Additionally, conditional expressions can contain boolean operators such as BOOLAND, <span class="keep-together"><code>BOOLOR</code></span>, and NOT.</p>
</div>
<div class="paragraph">
<p>At first glance, you may find Bitcoin&#8217;s flow control scripts confusing. That is because Bitcoin Script is a stack language. The same way that the arithmetic operation \(1 + 1\) looks "backward" when expressed in Bitcoin Script as 1 1 ADD, flow control clauses in
Bitcoin also look "backward."</p>
</div>
<div class="paragraph">
<p>In most traditional (procedural) programming languages, flow control looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Pseudocode of flow control in most programming languages</div>
<div class="content">
<pre>if (condition):
  code to run when condition is true
else:
  code to run when condition is false
code to run in either case</pre>
</div>
</div>
<div class="paragraph">
<p>In a stack-based language like Bitcoin Script, the logical condition comes <em>before</em> the IF, which makes it look "backward," like this:</p>
</div>
<div class="listingblock">
<div class="title">Bitcoin Script flow control</div>
<div class="content">
<pre>condition
IF
  code to run when condition is true
ELSE
  code to run when condition is false
ENDIF
code to run in either case</pre>
</div>
</div>
<div class="paragraph">
<p>When reading Bitcoin Script, remember that the condition being evaluated comes <em>before</em> the IF opcode.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_flow_control_in_scripts">Using Flow Control in Scripts</h4>
<div class="paragraph">
<p>A very common use for flow control in Bitcoin Script is to construct a locking script that offers multiple execution paths, each a different way of redeeming the UTXO.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a simple example, where we have two signers, Alice and Bob, and either one is able to redeem. With multisig, this would be expressed as a 1-of-2 multisig script. For the sake of demonstration, we will do the same thing with an IF clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>IF
 &lt;Alice's Pubkey&gt; CHECKSIG
ELSE
 &lt;Bob's Pubkey&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph">
<p>Looking at this locking script, you may be wondering: "Where is the condition? There is nothing preceding the IF clause!"</p>
</div>
<div class="paragraph">
<p>The condition is not part of the locking script. Instead, the condition will be <em>offered in the unlocking script</em>, allowing Alice and Bob to "choose" which execution path they want.</p>
</div>
<div class="paragraph">
<p>Alice redeems this with the unlocking script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Alice's Sig&gt; 1</pre>
</div>
</div>
<div class="paragraph">
<p>The 1 at the end serves as the condition (TRUE) that will make the IF clause execute the first redemption path for which Alice has a signature.</p>
</div>
<div class="paragraph">
<p>For Bob to redeem this, he would have to choose the second execution path by giving a FALSE value to the IF clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Bob's Sig&gt; 0</pre>
</div>
</div>
<div class="paragraph">
<p>Bob&#8217;s unlocking script puts a 0 on the stack, causing the IF clause to execute the second (ELSE) script, which requires Bob&#8217;s signature.</p>
</div>
<div class="paragraph">
<p>Because each of the two conditions also requires a signature, Alice can&#8217;t use the second clause and Bob can&#8217;t use the first clause; they don&#8217;t have the necessary signatures for that!</p>
</div>
<div class="paragraph">
<p>Since conditional flows can be nested, so can the TRUE / FALSE values in the unlocking script, to navigate a complex path of conditions.</p>
</div>
<div class="paragraph">
<p>In <a href="#htlc_script_example">A complex script used in the Lightning Network</a> you can see an example of the kind of complex script that is used in the Lightning Network, with multiple conditions.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup> The scripts used in the Lightning Network are highly optimized and compact, to minimize the on-chain footprint, so they are not easy to read and understand. Nevertheless, see if you can identify some of the Bitcoin Script concepts we learned about in this chapter.</p>
</div>
<div id="htlc_script_example" class="exampleblock">
<div class="title">Example 1. A complex script used in the Lightning Network</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre># To remote node with revocation key
DUP HASH160 &lt;RIPEMD160(SHA256(revocationpubkey))&gt; EQUAL
IF
    CHECKSIG
ELSE
    &lt;remote_htlcpubkey&gt; SWAP SIZE 32 EQUAL
    NOTIF
        # To local node via HTLC-timeout transaction (timelocked).
        DROP 2 SWAP &lt;local_htlcpubkey&gt; 2 CHECKMULTISIG
    ELSE
        # To remote node with preimage.
        HASH160 &lt;RIPEMD160(payment_hash)&gt; EQUALVERIFY
        CHECKSIG
    ENDIF
ENDIF</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Recall that change doesn&#8217;t have to be the last output in a transaction and is in fact indistinguishable from other outputs.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. The first argument (0) does not have any meaning but is required due to a bug in Bitcoin&#8217;s multisignature implementation. This issue is described in <em>Mastering Bitcoin</em>, <a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch07.asciidoc">Chapter 7</a>.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. From <a href="https://github.com/lightningnetwork/lightning-rfc/blob/master/03-transactions.md">BOLT #3</a>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-10-29 15:50:16 +0400
</div>
</div>
</body>
</html>